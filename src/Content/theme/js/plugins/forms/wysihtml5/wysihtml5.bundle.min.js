!function(n,t){"use strict";var f={"font-styles":function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li class='dropdown'><a class='btn btn-default dropdown-toggle"+i+"' data-toggle='dropdown' href='#'><i class='icon-font'><\/i>&nbsp;<span class='current-font'>"+n.font_styles.normal+"<\/span>&nbsp;<b class='caret'><\/b><\/a><ul class='dropdown-menu'><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div' tabindex='-1'>"+n.font_styles.normal+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1' tabindex='-1'>"+n.font_styles.h1+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2' tabindex='-1'>"+n.font_styles.h2+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h3' tabindex='-1'>"+n.font_styles.h3+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h4'>"+n.font_styles.h4+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h5'>"+n.font_styles.h5+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h6'>"+n.font_styles.h6+"<\/a><\/li><\/ul><\/li>"},emphasis:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='bold' title='"+n.emphasis.bold+"' tabindex='-1'><i class='icon-bold'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='italic' title='"+n.emphasis.italic+"' tabindex='-1'><i class='icon-italic'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='underline' title='"+n.emphasis.underline+"' tabindex='-1'><i class='icon-underline'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='strikeThrough' title='"+n.emphasis.strike+"' tabindex='-1'><i class='icon-strikethrough'><\/i><\/a><\/div><\/li>"},lists:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='insertUnorderedList' title='"+n.lists.unordered+"' tabindex='-1'><i class='icon-list'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='insertOrderedList' title='"+n.lists.ordered+"' tabindex='-1'><i class='icon-numbered-list'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='Outdent' title='"+n.lists.outdent+"' tabindex='-1'><i class='icon-indent-decrease'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='Indent' title='"+n.lists.indent+"' tabindex='-1'><i class='icon-indent-increase'><\/i><\/a><\/div><\/li>"},link:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='bootstrap-wysihtml5-insert-link-modal modal fade'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;<\/a><h4 class='modal-title'><i class='icon-link'><\/i>"+n.link.insert+"<\/h4><\/div><div class='modal-body with-padding'><div class='form-group'><input type='text' value='http://' class='bootstrap-wysihtml5-insert-link-url form-control'><label class='checkbox'> <input type='checkbox' class='bootstrap-wysihtml5-insert-link-target styled' checked>"+n.link.target+"<\/label><\/div><\/div><div class='modal-footer'><a href='#' class='btn btn-warning' data-dismiss='modal'>"+n.link.cancel+"<\/a><a href='#' class='btn btn-primary' data-dismiss='modal'>"+n.link.insert+"<\/a><\/div><\/div><\/div><\/div><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='createLink' title='"+n.link.insert+"' tabindex='-1'><i class='icon-link'><\/i><\/a><\/li>"},image:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='bootstrap-wysihtml5-insert-image-modal modal fade'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;<\/a><h4 class='modal-title'><i class='icon-image2'><\/i>"+n.image.insert+"<\/h4><\/div><div class='modal-body with-padding'><div class='form-group'><input type='text' value='http://' class='bootstrap-wysihtml5-insert-image-url form-control'><\/div><\/div><div class='modal-footer'><a href='#' class='btn btn-warning' data-dismiss='modal'>"+n.image.cancel+"<\/a><a href='#' class='btn btn-primary' data-dismiss='modal'>"+n.image.insert+"<\/a><\/div><\/div><\/div><\/div><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='insertImage' title='"+n.image.insert+"' tabindex='-1'><i class='icon-image2'><\/i><\/a><\/li>"},html:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-success btn-icon"+i+"' data-wysihtml5-action='change_view' title='"+n.html.edit+"' tabindex='-1'><i class='icon-code'><\/i><\/a><\/div><\/li>"},alignment:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifyleft' title='"+n.alignment.left+"' tabindex='-1'><i class='icon-paragraph-left2'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifyright' title='"+n.alignment.right+"' tabindex='-1'><i class='icon-paragraph-right2'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifycenter' title='"+n.alignment.center+"' tabindex='-1'><i class='icon-paragraph-center2'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifyfull' title='"+n.alignment.full+"' tabindex='-1'><i class='icon-paragraph-justify2'><\/i><\/a><\/div><\/li>"},action:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='undo' title='"+n.action.undo+"' tabindex='-1'><i class='icon-undo'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='redo' title='"+n.action.redo+"' tabindex='-1'><i class='icon-redo'><\/i><\/a><\/div><\/li>"},color:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li class='dropdown'><a class='btn btn-default dropdown-toggle"+i+"' data-toggle='dropdown' href='#' tabindex='-1'><i class='icon-droplet'><\/i><span class='current-color'>"+n.colours.black+"<\/span>&nbsp;<b class='caret'><\/b><\/a><ul class='dropdown-menu color-select'><li><div class='wysihtml5-colors' data-wysihtml5-command-value='black'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='black'>"+n.colours.black+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='silver'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='silver'>"+n.colours.silver+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='gray'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='gray'>"+n.colours.gray+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='maroon'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='maroon'>"+n.colours.maroon+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='red'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='red'>"+n.colours.red+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='purple'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='purple'>"+n.colours.purple+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='green'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='green'>"+n.colours.green+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='olive'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='olive'>"+n.colours.olive+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='navy'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='navy'>"+n.colours.navy+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='blue'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='blue'>"+n.colours.blue+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='orange'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='orange'>"+n.colours.orange+"<\/a><\/li><\/ul><\/li>"}},o=function(n,t,i){return f[n](t,i)},u=function(n,t){var i,u;this.el=n;i=t||r;for(u in i.customTemplates)f[u]=i.customTemplates[u];this.toolbar=this.createToolbar(n,i);this.editor=this.createEditor(t);window.editor=this.editor},i,r,e;u.prototype={constructor:u,createEditor:function(i){var r,u;if(i=i||{},i=n.extend(!0,{},i),i.toolbar=this.toolbar[0],r=new t.Editor(this.el[0],i),i&&i.events)for(u in i.events)r.on(u,i.events[u]);return r},createToolbar:function(t,i){var h=this,f=n("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"}),c=i.locale||r.locale||"en",u,s;for(u in r)s=!1,i[u]!==undefined?i[u]===!0&&(s=!0):s=r[u],s===!0&&(f.append(o(u,e[c],i)),u==="html"&&this.initHtml(f),u==="link"&&this.initInsertLink(f),u==="image"&&this.initInsertImage(f));if(i.toolbar)for(u in i.toolbar)f.append(i.toolbar[u]);return f.find("a[data-wysihtml5-command='formatBlock']").click(function(t){var i=t.target||t.srcElement,r=n(i);h.toolbar.find(".current-font").text(r.html())}),f.find("a[data-wysihtml5-command='foreColor']").click(function(t){var i=t.target||t.srcElement,r=n(i);h.toolbar.find(".current-color").text(r.html())}),this.el.before(f),f},initHtml:function(n){var t="a[data-wysihtml5-action='change_view']";n.find(t).click(function(){n.find("a.btn").not(t).toggleClass("disabled")})},initInsertImage:function(t){var r=this,i=t.find(".bootstrap-wysihtml5-insert-image-modal"),u=i.find(".bootstrap-wysihtml5-insert-image-url"),o=i.find("a.btn-primary"),s=u.val(),f,e=function(){var n=u.val();u.val(s);r.editor.currentView.element.focus();f&&(r.editor.composer.selection.setBookmark(f),f=null);r.editor.composer.commands.exec("insertImage",n)};u.keypress(function(n){n.which==13&&(e(),i.modal("hide"))});o.click(e);i.on("shown.bs.modal",function(){u.focus()});i.on("hide.bs.modal",function(){r.editor.currentView.element.focus()});t.find("a[data-wysihtml5-command=insertImage]").click(function(){var t=n(this).hasClass("wysihtml5-command-active");if(t)return!0;r.editor.currentView.element.focus(!1);f=r.editor.composer.selection.getBookmark();i.appendTo("body").modal("show");i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(n){n.stopPropagation()});return!1})},initInsertLink:function(t){var r=this,i=t.find(".bootstrap-wysihtml5-insert-link-modal"),u=i.find(".bootstrap-wysihtml5-insert-link-url"),o=i.find(".bootstrap-wysihtml5-insert-link-target"),s=i.find("a.btn-primary"),h=u.val(),f,e=function(){var t=u.val(),n;u.val(h);r.editor.currentView.element.focus();f&&(r.editor.composer.selection.setBookmark(f),f=null);n=o.prop("checked");r.editor.composer.commands.exec("createLink",{href:t,target:n?"_blank":"_self",rel:n?"nofollow":""})};u.keypress(function(n){n.which==13&&(e(),i.modal("hide"))});s.click(e);i.on("shown",function(){u.focus()});i.on("hide",function(){r.editor.currentView.element.focus()});t.find("a[data-wysihtml5-command=createLink]").click(function(){var t=n(this).hasClass("wysihtml5-command-active");if(t)return!0;r.editor.currentView.element.focus(!1);f=r.editor.composer.selection.getBookmark();i.appendTo("body").modal("show");i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(n){n.stopPropagation()});return!1})}};i={resetDefaults:function(){n.fn.wysihtml5.defaultOptions=n.extend(!0,{},n.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(t){return this.each(function(){var i=n(this);i.data("wysihtml5",new u(i,t))})},shallowExtend:function(t){var r=n.extend({},n.fn.wysihtml5.defaultOptions,t||{},n(this).data()),u=this;return i.bypassDefaults.apply(u,[r])},deepExtend:function(t){var r=n.extend(!0,{},n.fn.wysihtml5.defaultOptions,t||{}),u=this;return i.bypassDefaults.apply(u,[r])},init:function(n){var t=this;return i.shallowExtend.apply(t,[n])}};n.fn.wysihtml5=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on jQuery.wysihtml5");else return i.init.apply(this,arguments)};n.fn.wysihtml5.Constructor=u;r=n.fn.wysihtml5.defaultOptions={"font-styles":!0,color:!0,emphasis:!0,alignment:!0,lists:!0,link:!0,image:!0,action:!0,html:!0,events:{},parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url",target:"alt",rel:"alt"}},span:1,div:1,code:1,pre:1}},stylesheets:["./lib/css/wysiwyg-color.css"],locale:"en"};typeof n.fn.wysihtml5.defaultOptionsCache=="undefined"&&(n.fn.wysihtml5.defaultOptionsCache=n.extend(!0,{},n.fn.wysihtml5.defaultOptions));e=n.fn.wysihtml5.locale={en:{font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike through"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},action:{undo:"Undo",redo:"Redo"},html:{edit:"Edit HTML"},alignment:{left:"Align left",right:"Align right",center:"Align center",full:"Justify"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}}(window.jQuery,window.wysihtml5);var wysihtml5,Base;!function(n,t){"use strict";var f={"font-styles":function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li class='dropdown'><a class='btn btn-default dropdown-toggle"+i+"' data-toggle='dropdown' href='#'><i class='icon-font'><\/i>&nbsp;<span class='current-font'>"+n.font_styles.normal+"<\/span>&nbsp;<b class='caret'><\/b><\/a><ul class='dropdown-menu'><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div' tabindex='-1'>"+n.font_styles.normal+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1' tabindex='-1'>"+n.font_styles.h1+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2' tabindex='-1'>"+n.font_styles.h2+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h3' tabindex='-1'>"+n.font_styles.h3+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h4'>"+n.font_styles.h4+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h5'>"+n.font_styles.h5+"<\/a><\/li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h6'>"+n.font_styles.h6+"<\/a><\/li><\/ul><\/li>"},emphasis:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='bold' title='"+n.emphasis.bold+"' tabindex='-1'><i class='icon-bold'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='italic' title='"+n.emphasis.italic+"' tabindex='-1'><i class='icon-italic'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='underline' title='"+n.emphasis.underline+"' tabindex='-1'><i class='icon-underline'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='strikeThrough' title='"+n.emphasis.strike+"' tabindex='-1'><i class='icon-strikethrough'><\/i><\/a><\/div><\/li>"},lists:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='insertUnorderedList' title='"+n.lists.unordered+"' tabindex='-1'><i class='icon-list'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='insertOrderedList' title='"+n.lists.ordered+"' tabindex='-1'><i class='icon-numbered-list'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='Outdent' title='"+n.lists.outdent+"' tabindex='-1'><i class='icon-indent-decrease'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='Indent' title='"+n.lists.indent+"' tabindex='-1'><i class='icon-indent-increase'><\/i><\/a><\/div><\/li>"},link:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='bootstrap-wysihtml5-insert-link-modal modal fade'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;<\/a><h4 class='modal-title'><i class='icon-link'><\/i>"+n.link.insert+"<\/h4><\/div><div class='modal-body with-padding'><div class='form-group'><input type='text' value='http://' class='bootstrap-wysihtml5-insert-link-url form-control'><label class='checkbox'> <input type='checkbox' class='bootstrap-wysihtml5-insert-link-target styled' checked>"+n.link.target+"<\/label><\/div><\/div><div class='modal-footer'><a href='#' class='btn btn-warning' data-dismiss='modal'>"+n.link.cancel+"<\/a><a href='#' class='btn btn-primary' data-dismiss='modal'>"+n.link.insert+"<\/a><\/div><\/div><\/div><\/div><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='createLink' title='"+n.link.insert+"' tabindex='-1'><i class='icon-link'><\/i><\/a><\/li>"},image:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='bootstrap-wysihtml5-insert-image-modal modal fade'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;<\/a><h4 class='modal-title'><i class='icon-image2'><\/i>"+n.image.insert+"<\/h4><\/div><div class='modal-body with-padding'><div class='form-group'><input type='text' value='http://' class='bootstrap-wysihtml5-insert-image-url form-control'><\/div><\/div><div class='modal-footer'><a href='#' class='btn btn-warning' data-dismiss='modal'>"+n.image.cancel+"<\/a><a href='#' class='btn btn-primary' data-dismiss='modal'>"+n.image.insert+"<\/a><\/div><\/div><\/div><\/div><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='insertImage' title='"+n.image.insert+"' tabindex='-1'><i class='icon-image2'><\/i><\/a><\/li>"},html:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-success btn-icon"+i+"' data-wysihtml5-action='change_view' title='"+n.html.edit+"' tabindex='-1'><i class='icon-code'><\/i><\/a><\/div><\/li>"},alignment:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifyleft' title='"+n.alignment.left+"' tabindex='-1'><i class='icon-paragraph-left2'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifyright' title='"+n.alignment.right+"' tabindex='-1'><i class='icon-paragraph-right2'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifycenter' title='"+n.alignment.center+"' tabindex='-1'><i class='icon-paragraph-center2'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='justifyfull' title='"+n.alignment.full+"' tabindex='-1'><i class='icon-paragraph-justify2'><\/i><\/a><\/div><\/li>"},action:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li><div class='btn-group'><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='undo' title='"+n.action.undo+"' tabindex='-1'><i class='icon-undo'><\/i><\/a><a class='btn btn-default btn-icon"+i+"' data-wysihtml5-command='redo' title='"+n.action.redo+"' tabindex='-1'><i class='icon-redo'><\/i><\/a><\/div><\/li>"},color:function(n,t){var i=t&&t.size?" btn-"+t.size:"";return"<li class='dropdown'><a class='btn btn-default dropdown-toggle"+i+"' data-toggle='dropdown' href='#' tabindex='-1'><i class='icon-droplet'><\/i><span class='current-color'>"+n.colours.black+"<\/span>&nbsp;<b class='caret'><\/b><\/a><ul class='dropdown-menu color-select'><li><div class='wysihtml5-colors' data-wysihtml5-command-value='black'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='black'>"+n.colours.black+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='silver'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='silver'>"+n.colours.silver+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='gray'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='gray'>"+n.colours.gray+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='maroon'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='maroon'>"+n.colours.maroon+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='red'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='red'>"+n.colours.red+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='purple'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='purple'>"+n.colours.purple+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='green'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='green'>"+n.colours.green+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='olive'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='olive'>"+n.colours.olive+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='navy'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='navy'>"+n.colours.navy+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='blue'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='blue'>"+n.colours.blue+"<\/a><\/li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='orange'><\/div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='orange'>"+n.colours.orange+"<\/a><\/li><\/ul><\/li>"}},o=function(n,t,i){return f[n](t,i)},u=function(n,t){var i,u;this.el=n;i=t||r;for(u in i.customTemplates)f[u]=i.customTemplates[u];this.toolbar=this.createToolbar(n,i);this.editor=this.createEditor(t);window.editor=this.editor},i,r,e;u.prototype={constructor:u,createEditor:function(i){var r,u;if(i=i||{},i=n.extend(!0,{},i),i.toolbar=this.toolbar[0],r=new t.Editor(this.el[0],i),i&&i.events)for(u in i.events)r.on(u,i.events[u]);return r},createToolbar:function(t,i){var h=this,f=n("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"}),c=i.locale||r.locale||"en",u,s;for(u in r)s=!1,i[u]!==undefined?i[u]===!0&&(s=!0):s=r[u],s===!0&&(f.append(o(u,e[c],i)),u==="html"&&this.initHtml(f),u==="link"&&this.initInsertLink(f),u==="image"&&this.initInsertImage(f));if(i.toolbar)for(u in i.toolbar)f.append(i.toolbar[u]);return f.find("a[data-wysihtml5-command='formatBlock']").click(function(t){var i=t.target||t.srcElement,r=n(i);h.toolbar.find(".current-font").text(r.html())}),f.find("a[data-wysihtml5-command='foreColor']").click(function(t){var i=t.target||t.srcElement,r=n(i);h.toolbar.find(".current-color").text(r.html())}),this.el.before(f),f},initHtml:function(n){var t="a[data-wysihtml5-action='change_view']";n.find(t).click(function(){n.find("a.btn").not(t).toggleClass("disabled")})},initInsertImage:function(t){var r=this,i=t.find(".bootstrap-wysihtml5-insert-image-modal"),u=i.find(".bootstrap-wysihtml5-insert-image-url"),o=i.find("a.btn-primary"),s=u.val(),f,e=function(){var n=u.val();u.val(s);r.editor.currentView.element.focus();f&&(r.editor.composer.selection.setBookmark(f),f=null);r.editor.composer.commands.exec("insertImage",n)};u.keypress(function(n){n.which==13&&(e(),i.modal("hide"))});o.click(e);i.on("shown.bs.modal",function(){u.focus()});i.on("hide.bs.modal",function(){r.editor.currentView.element.focus()});t.find("a[data-wysihtml5-command=insertImage]").click(function(){var t=n(this).hasClass("wysihtml5-command-active");if(t)return!0;r.editor.currentView.element.focus(!1);f=r.editor.composer.selection.getBookmark();i.appendTo("body").modal("show");i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(n){n.stopPropagation()});return!1})},initInsertLink:function(t){var r=this,i=t.find(".bootstrap-wysihtml5-insert-link-modal"),u=i.find(".bootstrap-wysihtml5-insert-link-url"),o=i.find(".bootstrap-wysihtml5-insert-link-target"),s=i.find("a.btn-primary"),h=u.val(),f,e=function(){var t=u.val(),n;u.val(h);r.editor.currentView.element.focus();f&&(r.editor.composer.selection.setBookmark(f),f=null);n=o.prop("checked");r.editor.composer.commands.exec("createLink",{href:t,target:n?"_blank":"_self",rel:n?"nofollow":""})};u.keypress(function(n){n.which==13&&(e(),i.modal("hide"))});s.click(e);i.on("shown",function(){u.focus()});i.on("hide",function(){r.editor.currentView.element.focus()});t.find("a[data-wysihtml5-command=createLink]").click(function(){var t=n(this).hasClass("wysihtml5-command-active");if(t)return!0;r.editor.currentView.element.focus(!1);f=r.editor.composer.selection.getBookmark();i.appendTo("body").modal("show");i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(n){n.stopPropagation()});return!1})}};i={resetDefaults:function(){n.fn.wysihtml5.defaultOptions=n.extend(!0,{},n.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(t){return this.each(function(){var i=n(this);i.data("wysihtml5",new u(i,t))})},shallowExtend:function(t){var r=n.extend({},n.fn.wysihtml5.defaultOptions,t||{},n(this).data()),u=this;return i.bypassDefaults.apply(u,[r])},deepExtend:function(t){var r=n.extend(!0,{},n.fn.wysihtml5.defaultOptions,t||{}),u=this;return i.bypassDefaults.apply(u,[r])},init:function(n){var t=this;return i.shallowExtend.apply(t,[n])}};n.fn.wysihtml5=function(t){if(i[t])return i[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t!="object"&&t)n.error("Method "+t+" does not exist on jQuery.wysihtml5");else return i.init.apply(this,arguments)};n.fn.wysihtml5.Constructor=u;r=n.fn.wysihtml5.defaultOptions={"font-styles":!0,color:!0,emphasis:!0,alignment:!0,lists:!0,link:!0,image:!0,action:!0,html:!0,events:{},parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url",target:"alt",rel:"alt"}},span:1,div:1,code:1,pre:1}},stylesheets:["./lib/css/wysiwyg-color.css"],locale:"en"};typeof n.fn.wysihtml5.defaultOptionsCache=="undefined"&&(n.fn.wysihtml5.defaultOptionsCache=n.extend(!0,{},n.fn.wysihtml5.defaultOptions));e=n.fn.wysihtml5.locale={en:{font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",strike:"Strike through"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},action:{undo:"Undo",redo:"Redo"},html:{edit:"Edit HTML"},alignment:{left:"Align left",right:"Align right",center:"Align center",full:"Justify"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}}(window.jQuery,window.wysihtml5);wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"﻿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function t(n,t){var i=typeof n[t];return i==k||!!(i==b&&n[t])||"unknown"==i}function e(n,t){return!!(typeof n[t]==b&&n[t])}function p(n,t){return typeof n[t]!=u}function s(n){return function(t,i){for(var r=i.length;r--;)if(!n(t,i[r]))return!1;return!0}}function w(n){return n&&c(n,tt)&&l(n,nt)}function i(t){window.alert("Rangy not supported in your browser. Reason: "+t);n.initialized=!0;n.supported=!1}function h(){if(!n.initialized){var r,f=!1,u=!1;for(t(document,"createRange")&&(r=document.createRange(),c(r,g)&&l(r,d)&&(f=!0),r.detach()),(r=e(document,"body")?document.body:document.getElementsByTagName("body")[0])&&t(r,"createTextRange")&&(r=r.createTextRange(),w(r)&&(u=!0)),f||u||i("Neither Range nor TextRange are implemented"),n.initialized=!0,n.features={implementsDomRange:f,implementsTextRange:u},f=v.concat(a),u=0,r=f.length;u<r;++u)try{f[u](n)}catch(o){e(window,"console")&&t(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",o)}}}function r(n){this.name=n;this.supported=this.initialized=!1}var b="object",k="function",u="undefined",d="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),g="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),nt="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),tt="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),c=s(t),f=s(e),l=s(p),n={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:e,isHostProperty:p,areHostMethods:c,areHostObjects:f,areHostProperties:l,isTextRange:w},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}},a,v,o,y;if(n.fail=i,n.warn=function(t){t="Rangy warning: "+t;n.config.alertOnWarn?window.alert(t):typeof console!=u&&typeof window.console.log!=u&&window.console.log(t)},{}.hasOwnProperty?n.util.extend=function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])}:i("hasOwnProperty not supported"),a=[],v=[],n.init=h,n.addInitListener=function(t){n.initialized?t(n):a.push(t)},o=[],n.addCreateMissingNativeApiListener=function(n){o.push(n)},n.createMissingNativeApi=function(n){n=n||window;h();for(var t=0,i=o.length;t<i;++t)o[t](n)},r.prototype.fail=function(n){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+n);},r.prototype.warn=function(t){n.warn("Module "+this.name+": "+t)},r.prototype.createError=function(n){return Error("Error in Rangy "+this.name+" module: "+n)},n.createModule=function(t,i){var u=new r(t);n.modules[t]=u;v.push(function(n){i(n,u);u.initialized=!0;u.supported=!0})},n.requireModules=function(t){for(var f=0,e=t.length,i,u;f<e;++f){if(u=t[f],i=n.modules[u],!i||!(i instanceof r))throw Error("Module '"+u+"' not found");if(!i.supported)throw Error("Module '"+u+"' not supported");}},y=!1,f=function(){y||(y=!0,n.initialized||h())},typeof window==u)i("No window found");else if(typeof document==u)i("No document found");else return t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",f,!1),t(window,"addEventListener")?window.addEventListener("load",f,!1):t(window,"attachEvent")?window.attachEvent("onload",f):i("Window does not have required addEventListener or attachEvent method"),n}();rangy.createModule("DomUtil",function(n,t){function o(n){for(var t=0;n=n.previousSibling;)t++;return t}function l(n,t){for(var r=[],i=n;i;i=i.parentNode)r.push(i);for(i=t;i;i=i.parentNode)if(c(r,i))return i;return null}function u(n,t,i){for(i=i?n:n.parentNode;i;){if(n=i.parentNode,n===t)return i;i=n}return null}function s(n){return n=n.nodeType,3==n||4==n||8==n}function a(n,t){var i=t.nextSibling,r=t.parentNode;return i?r.insertBefore(n,i):r.appendChild(n),n}function e(n){if(9==n.nodeType)return n;if(typeof n.ownerDocument!=i)return n.ownerDocument;if(typeof n.document!=i)return n.document;if(n.parentNode)return e(n.parentNode);throw Error("getDocument: no document found for node");}function v(n){return n?s(n)?'"'+n.data+'"':1==n.nodeType?"<"+n.nodeName+(n.id?' id="'+n.id+'"':"")+">["+n.childNodes.length+"]":n.nodeName:"[No node]"}function y(n){this._next=this.root=n}function p(n,t){this.node=n;this.offset=t}function h(n){this.code=this[n];this.codeName=n;this.message="DOMException: "+this.codeName}var i="undefined",r=n.util,f,c;r.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method");r.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");f=document.createElement("div");r.areHostMethods(f,["insertBefore","appendChild","cloneNode"])||t.fail("Incomplete Element implementation");r.isHostProperty(f,"innerHTML")||t.fail("Element is missing innerHTML property");f=document.createTextNode("test");r.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"])||t.fail("Incomplete Text Node implementation");c=function(n,t){for(var i=n.length;i--;)if(n[i]===t)return!0;return!1};y.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next,t;if(this._current){if(t=n.firstChild,!t)for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}};p.prototype={equals:function(n){return this.node===n.node&this.offset==n.offset},inspect:function(){return"[DomPosition("+v(this.node)+":"+this.offset+")]"}};h.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};h.prototype.toString=function(){return this.message};n.dom={arrayContains:c,isHtmlNamespace:function(n){var t;return typeof n.namespaceURI==i||null===(t=n.namespaceURI)||"http://www.w3.org/1999/xhtml"==t},parentElement:function(n){return n=n.parentNode,1==n.nodeType?n:null},getNodeIndex:o,getNodeLength:function(n){var t;return s(n)?n.length:(t=n.childNodes)?t.length:0},getCommonAncestor:l,isAncestorOf:function(n,t,i){for(t=i?t:t.parentNode;t;){if(t===n)return!0;t=t.parentNode}return!1},getClosestAncestorIn:u,isCharacterDataNode:s,insertAfter:a,splitDataNode:function(n,t){var i=n.cloneNode(!1);return i.deleteData(0,t),n.deleteData(t,n.length-t),a(i,n),i},getDocument:e,getWindow:function(n){if(n=e(n),typeof n.defaultView!=i)return n.defaultView;if(typeof n.parentWindow!=i)return n.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(n){if(typeof n.contentWindow!=i)return n.contentWindow;if(typeof n.contentDocument!=i)return n.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(n){if(typeof n.contentDocument!=i)return n.contentDocument;if(typeof n.contentWindow!=i)return n.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(n){return r.isHostObject(n,"body")?n.body:n.getElementsByTagName("body")[0]},getRootContainer:function(n){for(var t;t=n.parentNode;)n=t;return n},comparePoints:function(n,t,i,r){var f;if(n==i)return t===r?0:t<r?-1:1;if(f=u(i,n,!0))return t<=o(f)?-1:1;if(f=u(n,i,!0))return o(f)<r?-1:1;if(t=l(n,i),n=n===t?t:u(n,t,!0),i=i===t?t:u(i,t,!0),n===i)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(t=t.firstChild;t;){if(t===n)return-1;if(t===i)return 1;t=t.nextSibling}throw Error("Should not be here!");},inspectNode:v,fragmentFromNodeChildren:function(n){for(var t=e(n).createDocumentFragment(),i;i=n.firstChild;)t.appendChild(i);return t},createIterator:function(n){return new y(n)},DomPosition:p};n.DOMException=h});rangy.createModule("DomRange",function(n){function c(n,i){return 3!=n.nodeType&&(t.isAncestorOf(n,i.startContainer,!0)||t.isAncestorOf(n,i.endContainer,!0))}function r(n){return t.getDocument(n.startContainer)}function et(n,t,i){if(t=n._listeners[t])for(var r=0,u=t.length;r<u;++r)t[r].call(n,{target:n,args:i})}function ot(n){return new ni(n.parentNode,t.getNodeIndex(n))}function b(n){return new ni(n.parentNode,t.getNodeIndex(n)+1)}function st(n,i,r){var u=11==n.nodeType?n.firstChild:n;return t.isCharacterDataNode(i)?r==i.length?t.insertAfter(n,i):i.parentNode.insertBefore(n,0==r?i:t.splitDataNode(i,r)):r>=i.childNodes.length?i.appendChild(n):i.insertBefore(n,i.childNodes[r]),u}function ht(n){for(var t,i,u=r(n.range).createDocumentFragment();i=n.next();){if(t=n.isPartiallySelectedSubtree(),i=i.cloneNode(!t),t&&(t=n.getSubtreeIterator(),i.appendChild(ht(t)),t.detach(!0)),10==i.nodeType)throw new e("HIERARCHY_REQUEST_ERR");u.appendChild(i)}return u}function y(n,i,r){for(var u,f,r=r||{stop:!1};u=n.next();)if(n.isPartiallySelectedSubtree()){if(!1===i(u)){r.stop=!0;break}else if(u=n.getSubtreeIterator(),y(u,i,r),u.detach(!0),r.stop)break}else for(u=t.createIterator(u);f=u.next();)if(!1===i(f)){r.stop=!0;return}}function ct(n){for(var t;n.next();)n.isPartiallySelectedSubtree()?(t=n.getSubtreeIterator(),ct(t),t.detach(!0)):n.remove()}function lt(n){for(var t,u=r(n.range).createDocumentFragment(),i;t=n.next();){if(n.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=n.getSubtreeIterator(),t.appendChild(lt(i)),i.detach(!0)):n.remove(),10==t.nodeType)throw new e("HIERARCHY_REQUEST_ERR");u.appendChild(t)}return u}function at(n,t,i){var u=!(!t||!t.length),f,e=!!i,r;return u&&(f=RegExp("^("+t.join("|")+")$")),r=[],y(new o(n,!1),function(n){(!u||f.test(n.nodeType))&&(!e||i(n))&&r.push(n)}),r}function vt(n){return"["+("undefined"==typeof n.getName?"Range":n.getName())+"("+t.inspectNode(n.startContainer)+":"+n.startOffset+", "+t.inspectNode(n.endContainer)+":"+n.endOffset+")]"}function o(n,i){if(this.range=n,this.clonePartiallySelectedTextNodes=i,!n.collapsed){this.sc=n.startContainer;this.so=n.startOffset;this.ec=n.endContainer;this.eo=n.endOffset;var r=n.commonAncestorContainer;this.sc===this.ec&&t.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===r&&!t.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:t.getClosestAncestorIn(this.sc,r,!0),this._last=this.ec===r&&!t.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:t.getClosestAncestorIn(this.ec,r,!0))}}function s(n){this.code=this[n];this.codeName=n;this.message="RangeException: "+this.codeName}function yt(n,t,i){this.nodes=at(n,t,i);this._next=this.nodes[0];this._position=0}function k(n){return function(i,r){for(var f,u=r?i:i.parentNode;u;){if(f=u.nodeType,t.arrayContains(n,f))return u;u=u.parentNode}return null}}function l(n,t){if(li(n,t))throw new s("INVALID_NODE_TYPE_ERR");}function f(n){if(!n.startContainer)throw new e("INVALID_STATE_ERR");}function a(n,i){if(!t.arrayContains(i,n.nodeType))throw new s("INVALID_NODE_TYPE_ERR");}function d(n,i){if(0>i||i>(t.isCharacterDataNode(n)?n.length:n.childNodes.length))throw new e("INDEX_SIZE_ERR");}function g(n,t){if(w(n,!0)!==w(t,!0))throw new e("WRONG_DOCUMENT_ERR");}function h(n){if(ci(n,!0))throw new e("NO_MODIFICATION_ALLOWED_ERR");}function p(n,t){if(!n)throw new e(t);}function i(n){if(f(n),!t.arrayContains(tt,n.startContainer.nodeType)&&!w(n.startContainer,!0)||!t.arrayContains(tt,n.endContainer.nodeType)&&!w(n.endContainer,!0)||!(n.startOffset<=(t.isCharacterDataNode(n.startContainer)?n.startContainer.length:n.startContainer.childNodes.length))||!(n.endOffset<=(t.isCharacterDataNode(n.endContainer)?n.endContainer.length:n.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+n.inspect()+")");}function nt(){}function pt(n){n.START_TO_START=ut;n.START_TO_END=ri;n.END_TO_END=ai;n.END_TO_START=ui;n.NODE_BEFORE=fi;n.NODE_AFTER=ei;n.NODE_BEFORE_AND_AFTER=oi;n.NODE_INSIDE=ft}function wt(n){pt(n);pt(n.prototype)}function bt(n,r){return function(){i(this);var u=this.startContainer,f=this.startOffset,e=this.commonAncestorContainer,s=new o(this,!0);return u!==e&&(u=t.getClosestAncestorIn(u,e,!0),f=b(u),u=f.node,f=f.offset),y(s,h),s.reset(),e=n(s),s.detach(),r(this,u,f,u,f),e}}function kt(r,u,e){function s(n,t){return function(i){f(this);a(i,ti);a(v(i),tt);i=(n?ot:b)(i);(t?y:p)(this,i.node,i.offset)}}function y(n,i,r){var f=n.endContainer,e=n.endOffset;(i!==n.startContainer||r!==n.startOffset)&&((v(i)!=v(f)||1==t.comparePoints(i,r,f,e))&&(f=i,e=r),u(n,i,r,f,e))}function p(n,i,r){var f=n.startContainer,e=n.startOffset;(i!==n.endContainer||r!==n.endOffset)&&((v(i)!=v(f)||-1==t.comparePoints(i,r,f,e))&&(f=i,e=r),u(n,f,e,i,r))}r.prototype=new nt;n.util.extend(r.prototype,{setStart:function(n,t){f(this);l(n,!0);d(n,t);y(this,n,t)},setEnd:function(n,t){f(this);l(n,!0);d(n,t);p(this,n,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(n){i(this);n?u(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):u(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(n){f(this);l(n,!0);u(this,n,0,n,t.getNodeLength(n))},selectNode:function(n){f(this);l(n,!1);a(n,ti);var t=ot(n),n=b(n);u(this,t.node,t.offset,n.node,n.offset)},extractContents:bt(lt,u),deleteContents:bt(ct,u),canSurroundContents:function(){i(this);h(this.startContainer);h(this.endContainer);var n=new o(this,!0),t=n._first&&c(n._first,this)||n._last&&c(n._last,this);return n.detach(),!t},detach:function(){e(this)},splitBoundaries:function(){i(this);var n=this.startContainer,e=this.startOffset,r=this.endContainer,f=this.endOffset,o=n===r;t.isCharacterDataNode(r)&&0<f&&f<r.length&&t.splitDataNode(r,f);t.isCharacterDataNode(n)&&0<e&&e<n.length&&(n=t.splitDataNode(n,e),o?(f-=e,r=n):r==n.parentNode&&f>=t.getNodeIndex(n)&&f++,e=0);u(this,n,e,r,f)},normalizeBoundaries:function(){i(this);var f=this.startContainer,e=this.startOffset,n=this.endContainer,r=this.endOffset,o=function(t){var i=t.nextSibling;i&&i.nodeType==t.nodeType&&(n=t,r=t.length,t.appendData(i.data),i.parentNode.removeChild(i))},h=function(i){var u=i.previousSibling,o;u&&u.nodeType==i.nodeType&&(f=i,o=i.length,e=u.length,i.insertData(0,u.data),u.parentNode.removeChild(u),f==n?(r+=e,n=f):n==i.parentNode&&(u=t.getNodeIndex(i),r==u?(n=i,r=o):r>u&&r--))},s=!0;t.isCharacterDataNode(n)?n.length==r&&o(n):(0<r&&(s=n.childNodes[r-1])&&t.isCharacterDataNode(s)&&o(s),s=!this.collapsed);s?t.isCharacterDataNode(f)?0==e&&h(f):e<f.childNodes.length&&(o=f.childNodes[e])&&t.isCharacterDataNode(o)&&h(o):(f=n,e=r);u(this,f,e,n,r)},collapseToPoint:function(n,t){f(this);l(n,!0);d(n,t);(n!==this.startContainer||t!==this.startOffset||n!==this.endContainer||t!==this.endOffset)&&u(this,n,t,n,t)}});wt(r)}function dt(n){n.collapsed=n.startContainer===n.endContainer&&n.startOffset===n.endOffset;n.commonAncestorContainer=n.collapsed?n.startContainer:t.getCommonAncestor(n.startContainer,n.endContainer)}function gt(n,t,i,r,u){var f=n.startContainer!==t||n.startOffset!==i,e=n.endContainer!==r||n.endOffset!==u;n.startContainer=t;n.startOffset=i;n.endContainer=r;n.endOffset=u;dt(n);et(n,"boundarychange",{startMoved:f,endMoved:e})}function u(n){this.startContainer=n;this.startOffset=0;this.endContainer=n;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};dt(this)}n.requireModules(["DomUtil"]);var t=n.dom,ni=t.DomPosition,e=n.DOMException;o.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var n=this._current=this._next;return n&&(this._next=n!==this._last?n.nextSibling:null,t.isCharacterDataNode(n)&&this.clonePartiallySelectedTextNodes&&(n===this.ec&&(n=n.cloneNode(!0)).deleteData(this.eo,n.length-this.eo),this._current===this.sc&&(n=n.cloneNode(!0)).deleteData(0,this.so))),n},remove:function(){var n=this._current,i,r;t.isCharacterDataNode(n)&&(n===this.sc||n===this.ec)?(i=n===this.sc?this.so:0,r=n===this.ec?this.eo:n.length,i!=r&&n.deleteData(i,r-i)):n.parentNode&&n.parentNode.removeChild(n)},isPartiallySelectedSubtree:function(){return c(this._current,this.range)},getSubtreeIterator:function(){var n;if(this.isSingleCharacterDataNode)n=this.range.cloneRange(),n.collapse();else{n=new u(r(this.range));var i=this._current,f=i,e=0,s=i,h=t.getNodeLength(i);t.isAncestorOf(i,this.sc,!0)&&(f=this.sc,e=this.so);t.isAncestorOf(i,this.ec,!0)&&(s=this.ec,h=this.eo);gt(n,f,e,s,h)}return new o(n,this.clonePartiallySelectedTextNodes)},detach:function(n){n&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};s.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};s.prototype.toString=function(){return this.message};yt.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var ti=[1,3,4,5,7,8,10],tt=[2,9,11],si=[1,3,4,5,7,8,10,11],hi=[1,3,4,5,7,8],v=t.getRootContainer,w=k([9,11]),ci=k([5,6,10,12]),li=k([6,10,12]),ii=document.createElement("style"),it=!1;try{ii.innerHTML="<b>x<\/b>";it=3==ii.firstChild.nodeType}catch(vi){}n.features.htmlParsingConforms=it;var rt="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),ut=0,ri=1,ai=2,ui=3,fi=0,ei=1,oi=2,ft=3;nt.prototype={attachListener:function(n,t){this._listeners[n].push(t)},compareBoundaryPoints:function(n,r){i(this);g(this.startContainer,r.startContainer);var u=n==ui||n==ut?"start":"end",f=n==ri||n==ut?"start":"end";return t.comparePoints(this[u+"Container"],this[u+"Offset"],r[f+"Container"],r[f+"Offset"])},insertNode:function(n){if(i(this),a(n,si),h(this.startContainer),t.isAncestorOf(n,this.startContainer,!0))throw new e("HIERARCHY_REQUEST_ERR");this.setStartBefore(st(n,this.startContainer,this.startOffset))},cloneContents:function(){i(this);var n,u;return this.collapsed?r(this).createDocumentFragment():this.startContainer===this.endContainer&&t.isCharacterDataNode(this.startContainer)?(n=this.startContainer.cloneNode(!0),n.data=n.data.slice(this.startOffset,this.endOffset),u=r(this).createDocumentFragment(),u.appendChild(n),u):(u=new o(this,!0),n=ht(u),u.detach(),n)},canSurroundContents:function(){i(this);h(this.startContainer);h(this.endContainer);var n=new o(this,!0),t=n._first&&c(n._first,this)||n._last&&c(n._last,this);return n.detach(),!t},surroundContents:function(n){if(a(n,hi),!this.canSurroundContents())throw new s("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(n.hasChildNodes())for(;n.lastChild;)n.removeChild(n.lastChild);st(n,this.startContainer,this.startOffset);n.appendChild(t);this.selectNode(n)},cloneRange:function(){i(this);for(var t=new u(r(this)),f=rt.length,n;f--;)n=rt[f],t[n]=this[n];return t},toString:function(){var r,n;return(i(this),n=this.startContainer,n===this.endContainer&&t.isCharacterDataNode(n))?3==n.nodeType||4==n.nodeType?n.data.slice(this.startOffset,this.endOffset):"":(r=[],n=new o(this,!0),y(n,function(n){(3==n.nodeType||4==n.nodeType)&&r.push(n.data)}),n.detach(),r.join(""))},compareNode:function(n){i(this);var r=n.parentNode,u=t.getNodeIndex(n);if(!r)throw new e("NOT_FOUND_ERR");return n=this.comparePoint(r,u),r=this.comparePoint(r,u+1),0>n?0<r?oi:fi:0<r?ei:ft},comparePoint:function(n,r){return i(this),p(n,"HIERARCHY_REQUEST_ERR"),g(n,this.startContainer),0>t.comparePoints(n,r,this.startContainer,this.startOffset)?-1:0<t.comparePoints(n,r,this.endContainer,this.endOffset)?1:0},createContextualFragment:it?function(n){var r=this.startContainer,u=t.getDocument(r),i;if(!r)throw new e("INVALID_STATE_ERR");return i=null,1==r.nodeType?i=r:t.isCharacterDataNode(r)&&(i=t.parentElement(r)),i=null===i||"HTML"==i.nodeName&&t.isHtmlNamespace(t.getDocument(i).documentElement)&&t.isHtmlNamespace(i)?u.createElement("body"):i.cloneNode(!1),i.innerHTML=n,t.fragmentFromNodeChildren(i)}:function(n){f(this);var i=r(this).createElement("body");return i.innerHTML=n,t.fragmentFromNodeChildren(i)},toHtml:function(){i(this);var n=r(this).createElement("div");return n.appendChild(this.cloneContents()),n.innerHTML},intersectsNode:function(n,u){var e,o,f;return(i(this),p(n,"NOT_FOUND_ERR"),t.getDocument(n)!==r(this))?!1:(f=n.parentNode,e=t.getNodeIndex(n),p(f,"NOT_FOUND_ERR"),o=t.comparePoints(f,e,this.endContainer,this.endOffset),f=t.comparePoints(f,e+1,this.startContainer,this.startOffset),u?0>=o&&0<=f:0>o&&0<f)},isPointInRange:function(n,r){return i(this),p(n,"HIERARCHY_REQUEST_ERR"),g(n,this.startContainer),0<=t.comparePoints(n,r,this.startContainer,this.startOffset)&&0>=t.comparePoints(n,r,this.endContainer,this.endOffset)},intersectsRange:function(n,u){if(i(this),r(n)!=r(this))throw new e("WRONG_DOCUMENT_ERR");var f=t.comparePoints(this.startContainer,this.startOffset,n.endContainer,n.endOffset),o=t.comparePoints(this.endContainer,this.endOffset,n.startContainer,n.startOffset);return u?0>=f&&0<=o:0>f&&0<o},intersection:function(n){if(this.intersectsRange(n)){var r=t.comparePoints(this.startContainer,this.startOffset,n.startContainer,n.startOffset),u=t.comparePoints(this.endContainer,this.endOffset,n.endContainer,n.endOffset),i=this.cloneRange();return-1==r&&i.setStart(n.startContainer,n.startOffset),1==u&&i.setEnd(n.endContainer,n.endOffset),i}return null},union:function(n){if(this.intersectsRange(n,!0)){var i=this.cloneRange();return-1==t.comparePoints(n.startContainer,n.startOffset,this.startContainer,this.startOffset)&&i.setStart(n.startContainer,n.startOffset),1==t.comparePoints(n.endContainer,n.endOffset,this.endContainer,this.endOffset)&&i.setEnd(n.endContainer,n.endOffset),i}throw new s("Ranges do not intersect");},containsNode:function(n,t){return t?this.intersectsNode(n,!1):this.compareNode(n)==ft},containsNodeContents:function(n){return 0<=this.comparePoint(n,0)&&0>=this.comparePoint(n,t.getNodeLength(n))},containsRange:function(n){return this.intersection(n).equals(n)},containsNodeText:function(n){var t=this.cloneRange(),i;return t.selectNode(n),i=t.getNodes([3]),0<i.length?(t.setStart(i[0],0),n=i.pop(),t.setEnd(n,n.length),n=this.containsRange(t),t.detach(),n):this.containsNodeContents(n)},createNodeIterator:function(n,t){return i(this),new yt(this,n,t)},getNodes:function(n,t){return i(this),at(this,n,t)},getDocument:function(){return r(this)},collapseBefore:function(n){f(this);this.setEndBefore(n);this.collapse(!1)},collapseAfter:function(n){f(this);this.setStartAfter(n);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(n){return u.rangesEqual(this,n)},inspect:function(){return vt(this)}};kt(u,gt,function(n){f(n);n.startContainer=n.startOffset=n.endContainer=n.endOffset=null;n.collapsed=n.commonAncestorContainer=null;et(n,"detach",null);n._listeners=null});n.rangePrototype=nt.prototype;u.rangeProperties=rt;u.RangeIterator=o;u.copyComparisonConstants=wt;u.createPrototypeRange=kt;u.inspect=vt;u.getRangeDocument=r;u.rangesEqual=function(n,t){return n.startContainer===t.startContainer&&n.startOffset===t.startOffset&&n.endContainer===t.endContainer&&n.endOffset===t.endOffset};n.DomRange=u;n.RangeException=s});rangy.createModule("WrappedRange",function(n){function f(n,i,u,f){var s=n.duplicate(),e,i,h,o;if(s.collapse(u),e=s.parentElement(),t.isAncestorOf(i,e,!0)||(e=i),!e.canHaveHTML)return new r(e.parentNode,t.getNodeIndex(e));i=t.getDocument(e).createElement("span");o=u?"StartToStart":"StartToEnd";do e.insertBefore(i,i.previousSibling),s.moveToElementText(i);while(0<(h=s.compareEndPoints(o,n))&&i.previousSibling);if(o=i.nextSibling,-1==h&&o&&t.isCharacterDataNode(o)){if(s.setEndPoint(u?"EndToStart":"EndToEnd",n),/[\r\n]/.test(o.data))for(e=s.duplicate(),u=e.text.replace(/\r\n/g,"\r").length,u=e.moveStart("character",u);-1==e.compareEndPoints("StartToEnd",e);)u++,e.moveStart("character",1);else u=s.text.length;e=new r(o,u)}else o=(f||!u)&&i.previousSibling,e=(u=(f||u)&&i.nextSibling)&&t.isCharacterDataNode(u)?new r(u,0):o&&t.isCharacterDataNode(o)?new r(o,o.length):new r(e,t.getNodeIndex(i));return i.parentNode.removeChild(i),e}function e(n,i){var r,f,o=n.offset,u=t.getDocument(n.node),e=u.body.createTextRange(),s=t.isCharacterDataNode(n.node);return s?(r=n.node,f=r.parentNode):(r=n.node.childNodes,r=o<r.length?r[o]:null,f=n.node),u=u.createElement("span"),u.innerHTML="&#feff;",r?f.insertBefore(u,r):f.appendChild(u),e.moveToElementText(u),e.collapse(!i),f.removeChild(u),s&&e[i?"moveStart":"moveEnd"]("character",o),e}var o;n.requireModules(["DomUtil","DomRange"]);var i,t=n.dom,r=t.DomPosition,u=n.DomRange;!n.features.implementsDomRange||n.features.implementsTextRange&&n.config.preferTextRange?n.features.implementsTextRange&&(i=function(n){this.textRange=n;this.refresh()},i.prototype=new u(document),i.prototype.refresh=function(){var i,n,r=this.textRange,u;i=r.parentElement();u=r.duplicate();u.collapse(!0);n=u.parentElement();u=r.duplicate();u.collapse(!1);r=u.parentElement();n=n==r?n:t.getCommonAncestor(n,r);n=n==i?n:t.getCommonAncestor(i,n);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?n=i=f(this.textRange,n,!0,!0):(i=f(this.textRange,n,!0,!1),n=f(this.textRange,n,!1,!1));this.setStart(i.node,i.offset);this.setEnd(n.node,n.offset)},u.copyComparisonConstants(i),o=function(){return this}(),"undefined"==typeof o.Range&&(o.Range=i),n.createNativeRange=function(n){return n=n||document,n.body.createTextRange()}):(function(){function o(n){for(var i=h.length,t;i--;)t=h[i],n[t]=n.nativeRange[t]}var r,h=u.rangeProperties,s,e,f;i=function(n){if(!n)throw Error("Range must be specified");this.nativeRange=n;o(this)};u.createPrototypeRange(i,function(n,t,i,r,u){var f=n.endContainer!==r||n.endOffset!=u;(n.startContainer!==t||n.startOffset!=i||f)&&(n.setEnd(r,u),n.setStart(t,i))},function(n){n.nativeRange.detach();n.detached=!0;for(var t=h.length,i;t--;)i=h[t],n[i]=null});r=i.prototype;r.selectNode=function(n){this.nativeRange.selectNode(n);o(this)};r.deleteContents=function(){this.nativeRange.deleteContents();o(this)};r.extractContents=function(){var n=this.nativeRange.extractContents();return o(this),n};r.cloneContents=function(){return this.nativeRange.cloneContents()};r.surroundContents=function(n){this.nativeRange.surroundContents(n);o(this)};r.collapse=function(n){this.nativeRange.collapse(n);o(this)};r.cloneRange=function(){return new i(this.nativeRange.cloneRange())};r.refresh=function(){o(this)};r.toString=function(){return this.nativeRange.toString()};e=document.createTextNode("test");t.getBody(document).appendChild(e);f=document.createRange();f.setStart(e,0);f.setEnd(e,0);try{f.setStart(e,1);r.setStart=function(n,t){this.nativeRange.setStart(n,t);o(this)};r.setEnd=function(n,t){this.nativeRange.setEnd(n,t);o(this)};s=function(n){return function(t){this.nativeRange[n](t);o(this)}}}catch(c){r.setStart=function(n,t){try{this.nativeRange.setStart(n,t)}catch(i){this.nativeRange.setEnd(n,t);this.nativeRange.setStart(n,t)}o(this)};r.setEnd=function(n,t){try{this.nativeRange.setEnd(n,t)}catch(i){this.nativeRange.setStart(n,t);this.nativeRange.setEnd(n,t)}o(this)};s=function(n,t){return function(i){try{this.nativeRange[n](i)}catch(r){this.nativeRange[t](i);this.nativeRange[n](i)}o(this)}}}r.setStartBefore=s("setStartBefore","setEndBefore");r.setStartAfter=s("setStartAfter","setEndAfter");r.setEndBefore=s("setEndBefore","setStartBefore");r.setEndAfter=s("setEndAfter","setStartAfter");f.selectNodeContents(e);r.selectNodeContents=f.startContainer==e&&f.endContainer==e&&0==f.startOffset&&f.endOffset==e.length?function(n){this.nativeRange.selectNodeContents(n);o(this)}:function(n){this.setStart(n,0);this.setEnd(n,u.getEndOffset(n))};f.selectNodeContents(e);f.setEnd(e,3);s=document.createRange();s.selectNodeContents(e);s.setEnd(e,4);s.setStart(e,2);r.compareBoundaryPoints=-1==f.compareBoundaryPoints(f.START_TO_END,s)&1==f.compareBoundaryPoints(f.END_TO_START,s)?function(n,t){return t=t.nativeRange||t,n==t.START_TO_END?n=t.END_TO_START:n==t.END_TO_START&&(n=t.START_TO_END),this.nativeRange.compareBoundaryPoints(n,t)}:function(n,t){return this.nativeRange.compareBoundaryPoints(n,t.nativeRange||t)};n.util.isHostMethod(f,"createContextualFragment")&&(r.createContextualFragment=function(n){return this.nativeRange.createContextualFragment(n)});t.getBody(document).removeChild(e);f.detach();s.detach()}(),n.createNativeRange=function(n){return n=n||document,n.createRange()});n.features.implementsTextRange&&(i.rangeToTextRange=function(n){if(n.collapsed)return e(new r(n.startContainer,n.startOffset),!0);var i=e(new r(n.startContainer,n.startOffset),!0),u=e(new r(n.endContainer,n.endOffset),!1),n=t.getDocument(n.startContainer).body.createTextRange();return n.setEndPoint("StartToStart",i),n.setEndPoint("EndToEnd",u),n});i.prototype.getName=function(){return"WrappedRange"};n.WrappedRange=i;n.createRange=function(t){return t=t||document,new i(n.createNativeRange(t))};n.createRangyRange=function(n){return n=n||document,new u(n)};n.createIframeRange=function(i){return n.createRange(t.getIframeDocument(i))};n.createIframeRangyRange=function(i){return n.createRangyRange(t.getIframeDocument(i))};n.addCreateMissingNativeApiListener(function(t){t=t.document;typeof t.createRange=="undefined"&&(t.createRange=function(){return n.createRange(this)});t=t=null})});rangy.createModule("WrappedSelection",function(n,t){function kt(n){return(n||window).getSelection()}function ct(n){return(n||window).document.selection}function c(n,t,i){var r=i?"end":"start",i=i?"start":"end";n.anchorNode=t[r+"Container"];n.anchorOffset=t[r+"Offset"];n.focusNode=t[i+"Container"];n.focusOffset=t[i+"Offset"]}function o(n){n.anchorNode=n.focusNode=null;n.anchorOffset=n.focusOffset=0;n.rangeCount=0;n.isCollapsed=!0;n._ranges.length=0}function ut(t){var i;return t instanceof s?(i=t._selectionNativeRange,i||(i=n.createNativeRange(r.getDocument(t.startContainer)),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=i,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof tt?i=t.nativeRange:n.features.implementsDomRange&&t instanceof r.getWindow(t.startContainer).Range&&(i=t),i}function ft(n){var i=n.getNodes(),t,u;n:if(i.length&&1==i[0].nodeType){for(t=1,u=i.length;t<u;++t)if(!r.isAncestorOf(i[0],i[t])){t=!1;break n}t=!0}else t=!1;if(!t)throw Error("getSingleElementFromRange: range "+n.inspect()+" did not consist of a single element");return i[0]}function lt(n,t){var i=new tt(t);n._ranges=[i];c(n,i,!1);n.rangeCount=1;n.isCollapsed=i.collapsed}function l(t){var i,f,e,u;if(t._ranges.length=0,"None"==t.docSelection.type)o(t);else if(i=t.docSelection.createRange(),i&&"undefined"!=typeof i.text)lt(t,i);else{for(t.rangeCount=i.length,e=r.getDocument(i.item(0)),u=0;u<t.rangeCount;++u)f=n.createRange(e),f.selectNode(i.item(u)),t._ranges.push(f);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed;c(t,t._ranges[t.rangeCount-1],!1)}}function at(n,t){for(var u=n.docSelection.createRange(),e=ft(t),i=r.getDocument(u.item(0)),i=r.getBody(i).createControlRange(),f=0,o=u.length;f<o;++f)i.add(u.item(f));try{i.add(e)}catch(s){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}i.select();l(n)}function b(n,t,i){this.nativeSelection=n;this.docSelection=t;this._ranges=[];this.win=i;this.refresh()}function vt(n,t){for(var i=r.getDocument(t[0].startContainer),i=r.getBody(i).createControlRange(),u=0,f;u<rangeCount;++u){f=ft(t[u]);try{i.add(f)}catch(e){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}i.select();l(n)}function yt(n,t){if(n.anchorNode&&r.getDocument(n.anchorNode)!==r.getDocument(t))throw new it("WRONG_DOCUMENT_ERR");}function pt(n){var i=[],u=new wt(n.anchorNode,n.anchorOffset),f=new wt(n.focusNode,n.focusOffset),e="function"==typeof n.getName?n.getName():"Selection",t,r;if("undefined"!=typeof n.rangeCount)for(t=0,r=n.rangeCount;t<r;++t)i[t]=s.inspect(n.getRangeAt(t));return"["+e+"(Ranges: "+i.join(", ")+")(anchor: "+u.inspect()+", focus: "+f.inspect()+"]"}var k,et,d,ot,e,i,g,st,nt,ht,a;n.requireModules(["DomUtil","DomRange","WrappedRange"]);n.config.checkSelectionRanges=!0;var r=n.dom,f=n.util,s=n.DomRange,tt=n.WrappedRange,it=n.DOMException,wt=r.DomPosition,v,rt,u=n.util.isHostMethod(window,"getSelection"),y=n.util.isHostObject(document,"selection"),p=y&&(!u||n.config.preferTextRange);p?(v=ct,n.isSelectionValid=function(n){var n=(n||window).document,t=n.selection;return"None"!=t.type||r.getDocument(t.createRange().parentElement())==n}):u?(v=kt,n.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected.");n.getNativeSelection=v;var u=v(),bt=n.createNativeRange(document),w=r.getBody(document),h=f.areHostObjects(u,f.areHostProperties(u,["anchorOffset","focusOffset"]));if(n.features.selectionHasAnchorAndFocus=h,k=f.isHostMethod(u,"extend"),n.features.selectionHasExtend=k,et="number"==typeof u.rangeCount,n.features.selectionHasRangeCount=et,d=!1,ot=!0,f.areHostMethods(u,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof u.rangeCount&&n.features.implementsDomRange&&function(){var i=document.createElement("iframe"),n,u;w.appendChild(i);n=r.getIframeDocument(i);n.open();n.write("<html><head><\/head><body>12<\/body><\/html>");n.close();var t=r.getIframeWindow(i).getSelection(),f=n.documentElement.lastChild.firstChild,n=n.createRange();n.setStart(f,1);n.collapse(!0);t.addRange(n);ot=t.rangeCount==1;t.removeAllRanges();u=n.cloneRange();n.setStart(f,0);u.setEnd(f,2);t.addRange(n);t.addRange(u);d=t.rangeCount==2;n.detach();u.detach();w.removeChild(i)}(),n.features.selectionSupportsMultipleRanges=d,n.features.collapsedNonEditableSelectionsSupported=ot,e=!1,w&&f.isHostMethod(w,"createControlRange")&&(i=w.createControlRange(),f.areHostProperties(i,["item","add"])&&(e=!0)),n.features.implementsControlRange=e,rt=h?function(n){return n.anchorNode===n.focusNode&&n.anchorOffset===n.focusOffset}:function(n){return n.rangeCount?n.getRangeAt(n.rangeCount-1).collapsed:!1},f.isHostMethod(u,"getRangeAt")?g=function(n,t){try{return n.getRangeAt(t)}catch(i){return null}}:h&&(g=function(t){var i=r.getDocument(t.anchorNode),i=n.createRange(i);return i.setStart(t.anchorNode,t.anchorOffset),i.setEnd(t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&(i.setStart(t.focusNode,t.focusOffset),i.setEnd(t.anchorNode,t.anchorOffset)),i}),n.getSelection=function(n){var n=n||window,t=n._rangySelection,i=v(n),r=y?ct(n):null;return t?(t.nativeSelection=i,t.docSelection=r,t.refresh(n)):(t=new b(i,r,n),n._rangySelection=t),t},n.getIframeSelection=function(t){return n.getSelection(r.getIframeWindow(t))},i=b.prototype,!p&&h&&f.areHostMethods(u,["removeAllRanges","addRange"]))i.removeAllRanges=function(){this.nativeSelection.removeAllRanges();o(this)},st=function(t,i){var r=s.getRangeDocument(i),r=n.createRange(r);r.collapseToPoint(i.endContainer,i.endOffset);t.nativeSelection.addRange(ut(r));t.nativeSelection.extend(i.startContainer,i.startOffset);t.refresh()},i.addRange=et?function(t,i){if(e&&y&&this.docSelection.type=="Control")at(this,t);else if(i&&k)st(this,t);else{var r;d?r=this.rangeCount:(this.removeAllRanges(),r=0);this.nativeSelection.addRange(ut(t));this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==r+1?(n.config.checkSelectionRanges&&(r=g(this.nativeSelection,this.rangeCount-1))&&!s.rangesEqual(r,t)&&(t=new tt(r)),this._ranges[this.rangeCount-1]=t,c(this,t,a(this.nativeSelection)),this.isCollapsed=rt(this)):this.refresh()}}:function(n,t){t&&k?st(this,n):(this.nativeSelection.addRange(ut(n)),this.refresh())},i.setRanges=function(n){if(e&&n.length>1)vt(this,n);else{this.removeAllRanges();for(var t=0,i=n.length;t<i;++t)this.addRange(n[t])}};else if(f.isHostMethod(u,"empty")&&f.isHostMethod(bt,"select")&&e&&p)i.removeAllRanges=function(){var n,t;try{this.docSelection.empty();this.docSelection.type!="None"&&(this.anchorNode?n=r.getDocument(this.anchorNode):this.docSelection.type=="Control"&&(t=this.docSelection.createRange(),t.length&&(n=r.getDocument(t.item(0)).body.createTextRange())),n&&(n.body.createTextRange().select(),this.docSelection.empty()))}catch(i){}o(this)},i.addRange=function(n){this.docSelection.type=="Control"?at(this,n):(tt.rangeToTextRange(n).select(),this._ranges[0]=n,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,c(this,n,!1))},i.setRanges=function(n){this.removeAllRanges();var t=n.length;t>1?vt(this,n):t&&this.addRange(n[0])};else return t.fail("No means of selecting a Range or TextRange was found"),!1;if(i.getRangeAt=function(n){if(n<0||n>=this.rangeCount)throw new it("INDEX_SIZE_ERR");return this._ranges[n]},p)nt=function(t){var i;n.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=r.getBody(t.win.document).createTextRange(),i.collapse(!0));t.docSelection.type=="Control"?l(t):i&&typeof i.text!="undefined"?lt(t,i):o(t)};else if(f.isHostMethod(u,"getRangeAt")&&"number"==typeof u.rangeCount)nt=function(t){if(e&&y&&t.docSelection.type=="Control")l(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,r=t.rangeCount;i<r;++i)t._ranges[i]=new n.WrappedRange(t.nativeSelection.getRangeAt(i));c(t,t._ranges[t.rangeCount-1],a(t.nativeSelection));t.isCollapsed=rt(t)}else o(t)};else if(h&&"boolean"==typeof u.isCollapsed&&"boolean"==typeof bt.collapsed&&n.features.implementsDomRange)nt=function(n){var t;t=n.nativeSelection;t.anchorNode?(t=g(t,0),n._ranges=[t],n.rangeCount=1,t=n.nativeSelection,n.anchorNode=t.anchorNode,n.anchorOffset=t.anchorOffset,n.focusNode=t.focusNode,n.focusOffset=t.focusOffset,n.isCollapsed=rt(n)):o(n)};else return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;i.refresh=function(n){var t=n?this._ranges.slice(0):null;if(nt(this),n){if(n=t.length,n!=this._ranges.length)return!1;for(;n--;)if(!s.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};ht=function(n,t){var r=n.getAllRanges(),u=!1,i,f;for(n.removeAllRanges(),i=0,f=r.length;i<f;++i)u||t!==r[i]?n.addRange(r[i]):u=!0;n.rangeCount||o(n)};i.removeRange=e?function(n){if(this.docSelection.type=="Control"){for(var t=this.docSelection.createRange(),n=ft(n),u=r.getDocument(t.item(0)),u=r.getBody(u).createControlRange(),f,e=!1,i=0,o=t.length;i<o;++i)f=t.item(i),f!==n||e?u.add(t.item(i)):e=!0;u.select();l(this)}else ht(this,n)}:function(n){ht(this,n)};!p&&h&&n.features.implementsDomRange?(a=function(n){var t=!1;return n.anchorNode&&(t=r.comparePoints(n.anchorNode,n.anchorOffset,n.focusNode,n.focusOffset)==1),t},i.isBackwards=function(){return a(this)}):a=i.isBackwards=function(){return!1};i.toString=function(){for(var t=[],n=0,i=this.rangeCount;n<i;++n)t[n]=""+this._ranges[n];return t.join("")};i.collapse=function(t,i){yt(this,t);var u=n.createRange(r.getDocument(t));u.collapseToPoint(t,i);this.removeAllRanges();this.addRange(u);this.isCollapsed=!0};i.collapseToStart=function(){if(this.rangeCount){var n=this._ranges[0];this.collapse(n.startContainer,n.startOffset)}else throw new it("INVALID_STATE_ERR");};i.collapseToEnd=function(){if(this.rangeCount){var n=this._ranges[this.rangeCount-1];this.collapse(n.endContainer,n.endOffset)}else throw new it("INVALID_STATE_ERR");};i.selectAllChildren=function(t){yt(this,t);var i=n.createRange(r.getDocument(t));i.selectNodeContents(t);this.removeAllRanges();this.addRange(i)};i.deleteFromDocument=function(){var n,t,i;if(e&&y&&this.docSelection.type=="Control"){for(n=this.docSelection.createRange();n.length;)t=n.item(0),n.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){for(n=this.getAllRanges(),this.removeAllRanges(),t=0,i=n.length;t<i;++t)n[t].deleteContents();this.addRange(n[i-1])}};i.getAllRanges=function(){return this._ranges.slice(0)};i.setSingleRange=function(n){this.setRanges([n])};i.containsNode=function(n,t){for(var i=0,r=this._ranges.length;i<r;++i)if(this._ranges[i].containsNode(n,t))return!0;return!1};i.toHtml=function(){var n="";if(this.rangeCount){for(var n=s.getRangeDocument(this._ranges[0]).createElement("div"),t=0,i=this._ranges.length;t<i;++t)n.appendChild(this._ranges[t].cloneContents());n=n.innerHTML}return n};i.getName=function(){return"WrappedSelection"};i.inspect=function(){return pt(this)};i.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};b.inspect=pt;n.Selection=b;n.selectionPrototype=i;n.addCreateMissingNativeApiListener(function(t){typeof t.getSelection=="undefined"&&(t.getSelection=function(){return n.getSelection(this)});t=null})});Base=function(){};Base.extend=function(n,t){var u=Base.prototype.extend,r,f,i;return Base._prototyping=!0,r=new this,u.call(r,n),r.base=function(){},delete Base._prototyping,f=r.constructor,i=r.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||u).call(arguments[0],r)},i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=r,i.toString=this.toString,i.valueOf=function(n){return"object"==n?i:f.valueOf()},u.call(i,t),"function"==typeof i.init&&i.init(),i};Base.prototype={extend:function(n,t){var r,f,t,u,i;if(1<arguments.length)r=this[n],r&&"function"==typeof t&&(!r.valueOf||r.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)&&(f=t.valueOf(),t=function(){var t=this.base||Base.prototype.base,n;return this.base=r,n=f.apply(this,arguments),this.base=t,n},t.valueOf=function(n){return"object"==n?t:f},t.toString=Base.toString),this[n]=t;else if(n){u=Base.prototype.extend;Base._prototyping||"function"==typeof this||(u=this.extend||u);for(var e={toSource:null},o=["constructor","toString","valueOf"],s=Base._prototyping?0:1;i=o[s++];)n[i]!=e[i]&&u.call(this,i,n[i]);for(i in n)e[i]||u.call(this,i,n[i])}return this}};Base=Base.extend({constructor:function(n){this.extend(n)}},{ancestor:Object,version:"1.1",forEach:function(n,t,i){for(var r in n)void 0===this.prototype[r]&&t.call(i,n[r],r,n)},implement:function(){for(var n=0;n<arguments.length;n++)"function"==typeof arguments[n]?arguments[n](this.prototype):this.prototype.extend(arguments[n]);return this},toString:function(){return""+this.valueOf()}});wysihtml5.browser=function(){var t=navigator.userAgent,r=document.createElement("div"),n=-1!==t.indexOf("MSIE")&&-1===t.indexOf("Opera"),i=-1!==t.indexOf("Gecko")&&-1===t.indexOf("KHTML"),u=-1!==t.indexOf("AppleWebKit/"),e=-1!==t.indexOf("Chrome/"),f=-1!==t.indexOf("Opera/");return{USER_AGENT:t,supported:function(){var n=this.USER_AGENT.toLowerCase(),t="contentEditable"in r,i=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,u=document.querySelector&&document.querySelectorAll,n=this.isIos()&&5>(/ipad|iphone|ipod/.test(n)&&n.match(/ os (\d+).+? like mac os x/)||[,0])[1]||-1!==n.indexOf("opera mobi")||-1!==n.indexOf("hpwos/");return t&&i&&u&&!n},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var n=this.USER_AGENT.toLowerCase();return-1!==n.indexOf("webkit")&&-1!==n.indexOf("mobile")},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!i},hasCurrentStyleProperty:function(){return"currentStyle"in r},insertsLineBreaksOnReturn:function(){return i},supportsPlaceholderAttributeOn:function(n){return"placeholder"in n},supportsEvent:function(n){var t;return(t="on"+n in r)||(r.setAttribute("on"+n,"return;"),t="function"==typeof r["on"+n]),t},supportsEventsInIframeCorrectly:function(){return!f},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return u||i},supportsDataTransfer:function(){try{return u&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(n){return!1}},supportsHTML5Tags:function(n){return n=n.createElement("div"),n.innerHTML="<article>foo<\/article>","<article>foo<\/article>"===n.innerHTML.toLowerCase()},supportsCommand:function(){var t={formatBlock:n,insertUnorderedList:n||f||u,insertOrderedList:n||f||u},r={insertHTML:i};return function(n,i){if(!t[i]){try{return n.queryCommandSupported(i)}catch(u){}try{return n.queryCommandEnabled(i)}catch(f){return!!r[i]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return i||f||u},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return i||n||f},clearsListsInContentEditableCorrectly:function(){return i||n||u},autoScrollsToCaret:function(){return!u},autoClosesUnclosedTags:function(){var n=r.cloneNode(!1),t;return n.innerHTML="<p><div><\/div>",n=n.innerHTML.toLowerCase(),t="<p><\/p><div><\/div>"===n||"<p><div><\/div><\/p>"===n,this.autoClosesUnclosedTags=function(){return t},t},supportsNativeGetElementsByClassName:function(){return-1!==(""+document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in r},needsSpaceAfterLineBreak:function(){return f},supportsSpeechApiOn:function(n){return 11<=(t.match(/Chrome\/(\d+)/)||[,0])[1]&&("onwebkitspeechchange"in n||"speech"in n)},crashesWhenDefineProperty:function(t){return n&&("XMLHttpRequest"===t||"XDomainRequest"===t)},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return i||e||f}}}();wysihtml5.lang.array=function(n){return{contains:function(t){if(n.indexOf)return-1!==n.indexOf(t);for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return!0;return!1},without:function(t){for(var t=wysihtml5.lang.array(t),r=[],i=0,u=n.length;i<u;i++)t.contains(n[i])||r.push(n[i]);return r},get:function(){for(var t=0,r=n.length,i=[];t<r;t++)i.push(n[t]);return i}}};wysihtml5.lang.Dispatcher=Base.extend({observe:function(n,t){return this.events=this.events||{},this.events[n]=this.events[n]||[],this.events[n].push(t),this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(n,t){this.events=this.events||{};for(var r=this.events[n]||[],i=0;i<r.length;i++)r[i].call(this,t);return this},stopObserving:function(n,t){this.events=this.events||{};var i=0,r,u;if(n){for(r=this.events[n]||[],u=[];i<r.length;i++)r[i]!==t&&t&&u.push(r[i]);this.events[n]=u}else this.events={};return this}});wysihtml5.lang.object=function(n){return{merge:function(t){for(var i in t)n[i]=t[i];return this},get:function(){return n},clone:function(){var t={};for(var i in n)t[i]=n[i];return t},isArray:function(){return"[object Array]"===Object.prototype.toString.call(n)}}},function(){var n=/^\s+/,t=/\s+$/;wysihtml5.lang.string=function(i){return i=""+i,{trim:function(){return i.replace(n,"").replace(t,"")},interpolate:function(n){for(var t in n)i=this.replace("#{"+t+"}").by(n[t]);return i},replace:function(n){return{by:function(t){return i.split(n).join(t)}}}}}}(),function(n){function e(n){return n.replace(t,function(n,t){var r=(t.match(u)||[])[1]||"",i=o[r],t=t.replace(u,""),e;return t.split(i).length>t.split(r).length&&(t+=r,r=""),e=i=t,t.length>f&&(e=e.substr(0,f)+"..."),"www."===i.substr(0,4)&&(i="http://"+i),'<a href="'+i+'">'+e+"<\/a>"+r})}function i(u){var s,f,o;if(!r.contains(u.nodeName))if(u.nodeType===n.TEXT_NODE&&u.data.match(t)){for(s=u.parentNode,f=s.ownerDocument,o=f._wysihtml5_tempElement,o||(o=f._wysihtml5_tempElement=f.createElement("div")),f=o,f.innerHTML="<span><\/span>"+e(u.data),f.removeChild(f.firstChild);f.firstChild;)s.insertBefore(f.firstChild,u);s.removeChild(u)}else{for(s=n.lang.array(u.childNodes).get(),f=s.length,o=0;o<f;o++)i(s[o]);return u}}var r=n.lang.array("CODE PRE A SCRIPT HEAD TITLE STYLE".split(" ")),t=/((https?:\/\/|www\.)[^\s<]{3,})/gi,u=/([^\w\/\-](,?))$/i,f=100,o={")":"(","]":"[","}":"{"};n.dom.autoLink=function(n){var t,u;n:{for(t=n;t.parentNode;){if(t=t.parentNode,u=t.nodeName,r.contains(u)){t=!0;break n}if("body"===u)break}t=!1}return t?n:(n===n.ownerDocument.documentElement&&(n=n.ownerDocument.body),i(n))};n.dom.autoLink.URL_REG_EXP=t}(wysihtml5),function(n){var i=n.browser.supportsClassList(),t=n.dom;t.addClass=function(n,r){if(i)return n.classList.add(r);t.hasClass(n,r)||(n.className+=" "+r)};t.removeClass=function(n,t){if(i)return n.classList.remove(t);n.className=n.className.replace(RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")};t.hasClass=function(n,t){if(i)return n.classList.contains(t);var r=n.className;return 0<r.length&&(r==t||RegExp("(^|\\s)"+t+"(\\s|$)").test(r))}}(wysihtml5);wysihtml5.dom.contains=function(){var n=document.documentElement;return n.contains?function(n,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),n!==t&&n.contains(t)}:n.compareDocumentPosition?function(n,t){return!!(n.compareDocumentPosition(t)&16)}:void 0}();wysihtml5.dom.convertToList=function(){function n(n,t){var i=n.createElement("li");return t.appendChild(i),i}return function(t,i){if("UL"===t.nodeName||"OL"===t.nodeName||"MENU"===t.nodeName)return t;for(var h=t.ownerDocument,s=h.createElement(i),o=t.querySelectorAll("br"),c=o.length,r,f,l,u,e=0;e<c;e++)for(r=o[e];(f=r.parentNode)&&f!==t&&f.lastChild===r;){if("block"===wysihtml5.dom.getStyle("display").from(f)){f.removeChild(r);break}wysihtml5.dom.insert(r).after(r.parentNode)}for(o=wysihtml5.lang.array(t.childNodes).get(),c=o.length,e=0;e<c;e++)u=u||n(h,s),r=o[e],f="block"===wysihtml5.dom.getStyle("display").from(r),l="BR"===r.nodeName,f?(u=u.firstChild?n(h,s):u,u.appendChild(r),u=null):l?u=u.firstChild?null:u:u.appendChild(r);return t.parentNode.replaceChild(s,t),s}}();wysihtml5.dom.copyAttributes=function(n){return{from:function(t){return{to:function(i){for(var r,u=0,f=n.length;u<f;u++)r=n[u],"undefined"!=typeof t[r]&&""!==t[r]&&(i[r]=t[r]);return{andTo:arguments.callee}}}}}},function(n){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],i=function(i){var u,r,f;n:for(r=0,f=t.length;r<f;r++)if("border-box"===n.getStyle(t[r]).from(i)){u=t[r];break n}return u?parseInt(n.getStyle("width").from(i),10)<i.offsetWidth:!1};n.copyStyles=function(r){return{from:function(u){i(u)&&(r=wysihtml5.lang.array(r).without(t));for(var o="",s=r.length,f=0,e;f<s;f++)e=r[f],o+=e+":"+n.getStyle(e).from(u)+";";return{to:function(t){n.setStyles(o).on(t);return{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(n){n.dom.delegate=function(t,i,r,u){return n.dom.observe(t,r,function(r){for(var f=r.target,e=n.lang.array(t.querySelectorAll(i));f&&f!==t;){if(e.contains(f)){u.call(f,r);break}f=f.parentNode}})}}(wysihtml5);wysihtml5.dom.getAsDom=function(){var n="abbr article aside audio bdi canvas command datalist details figcaption figure footer header hgroup keygen mark meter nav output progress rp rt ruby svg section source summary time track video wbr".split(" ");return function(t,i){var i=i||document,r,u,f;if("object"==typeof t&&t.nodeType)r=i.createElement("div"),r.appendChild(t);else if(wysihtml5.browser.supportsHTML5Tags(i))r=i.createElement("div"),r.innerHTML=t;else{if(r=i,!r._wysihtml5_supportsHTML5Tags){for(u=0,f=n.length;u<f;u++)r.createElement(n[u]);r._wysihtml5_supportsHTML5Tags=!0}r=i;u=r.createElement("div");u.style.display="none";r.body.appendChild(u);try{u.innerHTML=t}catch(e){}r.body.removeChild(u);r=u}return r}}();wysihtml5.dom.getParentElement=function(){function n(n,t){return!t||!t.length?!0:"string"==typeof t?n===t:wysihtml5.lang.array(t).contains(n)}return function(t,i,r){var u,f;if(r=r||50,i.className||i.classRegExp){n:{for(var e=i.nodeName,o=i.className,i=i.classRegExp;r--&&t&&"BODY"!==t.nodeName;){if((u=t.nodeType===wysihtml5.ELEMENT_NODE)&&(u=n(t.nodeName,e))&&(u=o,f=(t.className||"").match(i)||[],u=u?f[f.length-1]===u:!!f.length),u)break n;t=t.parentNode}t=null}return t}n:{for(e=i.nodeName,o=r;o--&&t&&"BODY"!==t.nodeName;){if(n(t.nodeName,e))break n;t=t.parentNode}t=null}return t}}();wysihtml5.dom.getStyle=function(){function n(n){return n.replace(i,function(n){return n.charAt(1).toUpperCase()})}var t={float:"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},i=/\-[a-z]/g;return function(i){return{from:function(r){var u,f,o;if(r.nodeType===wysihtml5.ELEMENT_NODE){var f=r.ownerDocument,u=t[i]||n(i),e=r.style,s=r.currentStyle,h=e[u];if(h)return h;if(s)try{return s[u]}catch(c){}if(u=f.defaultView||f.parentWindow,f=("height"===i||"width"===i)&&"TEXTAREA"===r.nodeName,u.getComputedStyle)return f&&(o=e.overflow,e.overflow="hidden"),r=u.getComputedStyle(r,null).getPropertyValue(i),f&&(e.overflow=o||""),r}}}}}();wysihtml5.dom.hasElementWithTagName=function(){var n={},t=1;return function(i,r){var f=(i._wysihtml5_identifier||(i._wysihtml5_identifier=t++))+":"+r,u=n[f];return u||(u=n[f]=i.getElementsByTagName(r)),0<u.length}}(),function(n){var t={},i=1;n.dom.hasElementWithClassName=function(r,u){if(!n.browser.supportsNativeGetElementsByClassName())return!!r.querySelector("."+u);var e=(r._wysihtml5_identifier||(r._wysihtml5_identifier=i++))+":"+u,f=t[e];return f||(f=t[e]=r.getElementsByClassName(u)),0<f.length}}(wysihtml5);wysihtml5.dom.insert=function(n){return{after:function(t){t.parentNode.insertBefore(n,t.nextSibling)},before:function(t){t.parentNode.insertBefore(n,t)},into:function(t){t.appendChild(n)}}};wysihtml5.dom.insertCSS=function(n){return n=n.join("\n"),{into:function(t){var r=t.head||t.getElementsByTagName("head")[0],i=t.createElement("style");i.type="text/css";i.styleSheet?i.styleSheet.cssText=n:i.appendChild(t.createTextNode(n));r&&r.appendChild(i)}}};wysihtml5.dom.observe=function(n,t,i){for(var t="string"==typeof t?[t]:t,r,u,f=0,e=t.length;f<e;f++)u=t[f],n.addEventListener?n.addEventListener(u,i,!1):(r=function(t){"target"in t||(t.target=t.srcElement);t.preventDefault=t.preventDefault||function(){this.returnValue=!1};t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0};i.call(n,t)},n.attachEvent("on"+u,r));return{stop:function(){for(var u,f=0,e=t.length;f<e;f++)u=t[f],n.removeEventListener?n.removeEventListener(u,i,!1):n.detachEvent("on"+u,r)}}};wysihtml5.dom.parse=function(){function t(n,i){var o=n.childNodes,s=o.length,f,e;if(f=u[n.nodeType],e=0,f=f&&f(n),!f)return null;for(e=0;e<s;e++)(newChild=t(o[e],i))&&f.appendChild(newChild);return i&&1>=f.childNodes.length&&f.nodeName.toLowerCase()===r&&!f.attributes.length?f.firstChild:f}function i(n,t){var t=t.toLowerCase(),i,r;if((i="IMG"==n.nodeName)&&(i="src"==t)){try{r=n.complete&&!n.mozMatchesSelector(":-moz-broken")}catch(u){n.complete&&"complete"===n.readyState&&(r=!0)}i=!0===r}return i?n.src:o&&"outerHTML"in n?-1!=n.outerHTML.toLowerCase().indexOf(" "+t+"=")?n.getAttribute(t):null:n.getAttribute(t)}var u={1:function(t){var u,e,o=n.tags,v,b,c;if((e=t.nodeName.toLowerCase(),u=t.scopeName,t._wysihtml5)||(t._wysihtml5=1,"wysihtml5-temp"===t.className))return null;if(u&&"HTML"!=u&&(e=u+":"+e),"outerHTML"in t&&!wysihtml5.browser.autoClosesUnclosedTags()&&"P"===t.nodeName&&"<\/p>"!==t.outerHTML.slice(-4).toLowerCase()&&(e="div"),e in o){if(u=o[e],!u||u.remove)return null;u="string"==typeof u?{rename_tag:u}:u}else if(t.firstChild)u={rename_tag:r};else return null;e=t.ownerDocument.createElement(u.rename_tag||e);var o={},y=u.set_class,p=u.add_class,l=u.set_attributes,k=u.check_attributes,w=n.classes,d=0,a=[];if(u=[],v=[],b=[],l&&(o=wysihtml5.lang.object(l).clone()),k)for(c in k)(l=s[k[c]])&&(l=l(i(t,c)),"string"==typeof l&&(o[c]=l));if(y&&a.push(y),p)for(c in p)(l=h[p[c]])&&(y=l(i(t,c)),"string"==typeof y&&a.push(y));for(w["_wysihtml5-temp-placeholder"]=1,(b=t.getAttribute("class"))&&(a=a.concat(b.split(f))),p=a.length;d<p;d++)t=a[d],w[t]&&u.push(t);for(w=u.length;w--;)t=u[w],wysihtml5.lang.array(v).contains(t)||v.unshift(t);v.length&&(o["class"]=v.join(" "));for(c in o)try{e.setAttribute(c,o[c])}catch(g){}return o.src&&("undefined"!=typeof o.width&&e.setAttribute("width",o.width),"undefined"!=typeof o.height&&e.setAttribute("height",o.height)),e},3:function(n){return n.ownerDocument.createTextNode(n.data)}},r="span",f=/\s+/,e={tags:{},classes:{}},n={},o=!wysihtml5.browser.supportsGetAttributeCorrectly(),s={url:function(){var n=/^https?:\/\//i;return function(t){return!t||!t.match(n)?null:t.replace(n,function(n){return n.toLowerCase()})}}(),alt:function(){var n=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(n,""):""}}(),numbers:function(){var n=/\D/g;return function(t){return(t=(t||"").replace(n,""))||null}}()},h={align_img:function(){var n={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return n[(""+t).toLowerCase()]}}(),align_text:function(){var n={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return n[(""+t).toLowerCase()]}}(),clear_br:function(){var n={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return n[(""+t).toLowerCase()]}}(),size_font:function(){var n={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return n[(""+t).charAt(0)]}}()};return function(i,r,u,f){wysihtml5.lang.object(n).merge(e).merge(r).get();for(var u=u||i.ownerDocument||document,r=u.createDocumentFragment(),o="string"==typeof i,i=o?wysihtml5.dom.getAsDom(i,u):i;i.firstChild;)u=i.firstChild,i.removeChild(u),(u=t(u,f))&&r.appendChild(u);return i.innerHTML="",i.appendChild(r),o?wysihtml5.quirks.getCorrectInnerHTML(i):i}}();wysihtml5.dom.removeEmptyTextNodes=function(n){for(var i=wysihtml5.lang.array(n.childNodes).get(),r=i.length,t=0;t<r;t++)n=i[t],n.nodeType===wysihtml5.TEXT_NODE&&""===n.data&&n.parentNode.removeChild(n)};wysihtml5.dom.renameElement=function(n,t){for(var i=n.ownerDocument.createElement(t),r;r=n.firstChild;)i.appendChild(r);return wysihtml5.dom.copyAttributes(["align","className"]).from(n).to(i),n.parentNode.replaceChild(i,n),i};wysihtml5.dom.replaceWithChildNodes=function(n){if(n.parentNode)if(n.firstChild){for(var t=n.ownerDocument.createDocumentFragment();n.firstChild;)t.appendChild(n.firstChild);n.parentNode.replaceChild(t,n)}else n.parentNode.removeChild(n)},function(n){function t(n){var t=n.ownerDocument.createElement("br");n.appendChild(t)}n.resolveList=function(i){if(!("MENU"!==i.nodeName&&"UL"!==i.nodeName&&"OL"!==i.nodeName)){var f=i.ownerDocument.createDocumentFragment(),r=i.previousElementSibling||i.previousSibling,o,e,u;for(r&&"block"!==n.getStyle("display").from(r)&&t(f);u=i.firstChild;){for(o=u.lastChild;r=u.firstChild;)e=(e=r===o)&&"block"!==n.getStyle("display").from(r)&&"BR"!==r.nodeName,f.appendChild(r),e&&t(f);u.parentNode.removeChild(u)}i.parentNode.replaceChild(f,i)}}}(wysihtml5.dom),function(n){var t=document,i="parent top opener frameElement frames localStorage globalStorage sessionStorage indexedDB".split(" "),r="open close openDialog showModalDialog alert confirm prompt openDatabase postMessage XMLHttpRequest XDomainRequest".split(" "),u=["referrer","write","open","close"];n.dom.Sandbox=Base.extend({constructor:function(t,i){this.callback=t||n.EMPTY_FUNCTION;this.config=n.lang.object({}).merge(i).get();this.iframe=this._createIframe()},insertInto:function(n){"string"==typeof n&&(n=t.getElementById(n));n.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var n=this.getIframe();n.parentNode.removeChild(n)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var r=this,i=t.createElement("iframe");i.className="wysihtml5-sandbox";n.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(i);return n.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(i.src="javascript:'<html><\/html>'"),i.onload=function(){i.onreadystatechange=i.onload=null;r._onLoadIframe(i)},i.onreadystatechange=function(){/loaded|complete/.test(i.readyState)&&(i.onreadystatechange=i.onload=null,r._onLoadIframe(i))},i},_onLoadIframe:function(f){var o,e;if(n.dom.contains(t.documentElement,f)){var c=this,h=f.contentWindow,s=f.contentWindow.document,e=this._getHtml({charset:t.characterSet||t.charset||"utf-8",stylesheets:this.config.stylesheets});if(s.open("text/html","replace"),s.write(e),s.close(),this.getWindow=function(){return f.contentWindow},this.getDocument=function(){return f.contentWindow.document},h.onerror=function(n,t,i){throw Error("wysihtml5.Sandbox: "+n,t,i);},!n.browser.supportsSandboxedIframes()){for(e=0,o=i.length;e<o;e++)this._unset(h,i[e]);for(e=0,o=r.length;e<o;e++)this._unset(h,r[e],n.EMPTY_FUNCTION);for(e=0,o=u.length;e<o;e++)this._unset(s,u[e]);this._unset(s,"cookie","",!0)}this.loaded=!0;setTimeout(function(){c.callback(c)},0)}},_getHtml:function(t){var i=t.stylesheets,u="",r=0,f;if(i="string"==typeof i?[i]:i)for(f=i.length;r<f;r++)u+='<link rel="stylesheet" href="'+i[r]+'">';return t.stylesheets=u,n.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}<\/head><body><\/body><\/html>').interpolate(t)},_unset:function(t,i,r,u){try{t[i]=r}catch(e){}try{t.__defineGetter__(i,function(){return r})}catch(o){}if(u)try{t.__defineSetter__(i,function(){})}catch(s){}if(!n.browser.crashesWhenDefineProperty(i))try{var f={get:function(){return r}};u&&(f.set=function(){});Object.defineProperty(t,i,f)}catch(h){}}})}(wysihtml5),function(){var n={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(i){for(var r in t)i.setAttribute(n[r]||r,t[r])}}}}();wysihtml5.dom.setStyles=function(n){return{on:function(t){if(t=t.style,"string"==typeof n)t.cssText+=";"+n;else for(var i in n)"float"===i?(t.cssFloat=n[i],t.styleFloat=n[i]):t[i]=n[i]}}},function(n){n.simulatePlaceholder=function(t,i,r){var u=function(){i.hasPlaceholderSet()&&i.clear();n.removeClass(i.element,"placeholder")},f=function(){i.isEmpty()&&(i.setValue(r),n.addClass(i.element,"placeholder"))};t.observe("set_placeholder",f).observe("unset_placeholder",u).observe("focus:composer",u).observe("paste:composer",u).observe("blur:composer",f);f()}}(wysihtml5.dom),function(n){var t=document.documentElement;"textContent"in t?(n.setTextContent=function(n,t){n.textContent=t},n.getTextContent=function(n){return n.textContent}):"innerText"in t?(n.setTextContent=function(n,t){n.innerText=t},n.getTextContent=function(n){return n.innerText}):(n.setTextContent=function(n,t){n.nodeValue=t},n.getTextContent=function(n){return n.nodeValue})}(wysihtml5.dom);wysihtml5.quirks.cleanPastedHTML=function(){var n={"a u":wysihtml5.dom.replaceWithChildNodes};return function(t,i,r){var i=i||n,r=r||t.ownerDocument||document,o="string"==typeof t,u,s,f,e=0,t=o?wysihtml5.dom.getAsDom(t,r):t;for(f in i)for(u=t.querySelectorAll(f),r=i[f],s=u.length;e<s;e++)r(u[e]);return o?t.innerHTML:t}}(),function(n){var t=n.dom;n.quirks.ensureProperClearing=function(){var n=function(){var n=this;setTimeout(function(){var t=n.innerHTML.toLowerCase();("<p>&nbsp;<\/p>"==t||"<p>&nbsp;<\/p><p>&nbsp;<\/p>"==t)&&(n.innerHTML="")},0)};return function(i){t.observe(i.element,["cut","keydown"],n)}}();n.quirks.ensureProperClearingOfLists=function(){var i=["OL","UL","MENU"];return function(r){t.observe(r.element,"keydown",function(u){if(u.keyCode===n.BACKSPACE_KEY){var f=r.selection.getSelectedNode(),u=r.element;u.firstChild&&n.lang.array(i).contains(u.firstChild.nodeName)&&(f=t.getParentElement(f,{nodeName:i}))&&f==u.firstChild&&1>=f.childNodes.length&&(f.firstChild?""===f.firstChild.innerHTML:1)&&f.parentNode.removeChild(f)}})}}()}(wysihtml5),function(n){n.quirks.getCorrectInnerHTML=function(t){var i=t.innerHTML,t,u,f,e,r;if(-1===i.indexOf("%7E"))return i;for(t=t.querySelectorAll("[href*='~'], [src*='~']"),r=0,e=t.length;r<e;r++)u=t[r].href||t[r].src,f=n.lang.string(u).replace("~").by("%7E"),i=n.lang.string(i).replace(f).by(u);return i}}(wysihtml5),function(n){var t=n.dom,i="LI P H1 H2 H3 H4 H5 H6".split(" "),r=["UL","OL","MENU"];n.quirks.insertLineBreakOnReturn=function(u){function f(i){if(i=t.getParentElement(i,{nodeName:["P","DIV"]},2)){var r=document.createTextNode(n.INVISIBLE_SPACE);t.insert(r).before(i);t.replaceWithChildNodes(i);u.selection.selectNode(r)}}t.observe(u.element.ownerDocument,"keydown",function(e){var o=e.keyCode,s;e.shiftKey||o!==n.ENTER_KEY&&o!==n.BACKSPACE_KEY||(s=u.selection.getSelectedNode(),(s=t.getParentElement(s,{nodeName:i},4))?"LI"===s.nodeName&&(o===n.ENTER_KEY||o===n.BACKSPACE_KEY)?setTimeout(function(){var n=u.selection.getSelectedNode(),i;n&&((i=t.getParentElement(n,{nodeName:r},2))||f(n))},0):s.nodeName.match(/H[1-6]/)&&o===n.ENTER_KEY&&setTimeout(function(){f(u.selection.getSelectedNode())},0):o===n.ENTER_KEY&&!n.browser.insertsLineBreaksOnReturn()&&(u.commands.exec("insertLineBreak"),e.preventDefault()))})}}(wysihtml5),function(n){n.quirks.redraw=function(t){n.dom.addClass(t,"wysihtml5-quirks-redraw");n.dom.removeClass(t,"wysihtml5-quirks-redraw");try{var i=t.ownerDocument;i.execCommand("italic",!1,null);i.execCommand("italic",!1,null)}catch(r){}}}(wysihtml5),function(n){var t=n.dom;n.Selection=Base.extend({constructor:function(n){window.rangy.init();this.editor=n;this.composer=n.composer;this.doc=this.composer.doc},getBookmark:function(){var n=this.getRange();return n&&n.cloneRange()},setBookmark:function(n){n&&this.setSelection(n)},setBefore:function(n){var t=rangy.createRange(this.doc);return t.setStartBefore(n),t.setEndBefore(n),this.setSelection(t)},setAfter:function(n){var t=rangy.createRange(this.doc);return t.setStartAfter(n),t.setEndAfter(n),this.setSelection(t)},selectNode:function(i){var r=rangy.createRange(this.doc),e=i.nodeType===n.ELEMENT_NODE,f="canHaveHTML"in i?i.canHaveHTML:"IMG"!==i.nodeName,u=e?i.innerHTML:i.data,u=""===u||u===n.INVISIBLE_SPACE,o=t.getStyle("display").from(i),o="block"===o||"list-item"===o;if(u&&e&&f)try{i.innerHTML=n.INVISIBLE_SPACE}catch(s){}f?r.selectNodeContents(i):r.selectNode(i);f&&u&&e?r.collapse(o):f&&u&&(r.setStartAfter(i),r.setEndAfter(i));this.setSelection(r)},getSelectedNode:function(n){return n&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange())&&n.length?n.item(0):(n=this.getSelection(this.doc),n.focusNode===n.anchorNode?n.focusNode:(n=this.getRange(this.doc))?n.commonAncestorContainer:this.doc.body)},executeAndRestore:function(t,i){var u=this.doc.body,e=i&&u.scrollTop,o=i&&u.scrollLeft,f='<span class="_wysihtml5-temp-placeholder">'+n.INVISIBLE_SPACE+"<\/span>",r=this.getRange(this.doc);if(r){f=r.createContextualFragment(f);r.insertNode(f);try{t(r.startContainer,r.endContainer)}catch(s){setTimeout(function(){throw s;},0)}(caretPlaceholder=this.doc.querySelector("._wysihtml5-temp-placeholder"))?(r=rangy.createRange(this.doc),r.selectNode(caretPlaceholder),r.deleteContents(),this.setSelection(r)):u.focus();i&&(u.scrollTop=e,u.scrollLeft=o);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(h){}}else t(u,u)},executeAndRestoreSimple:function(n){var i,f,t=this.getRange(),r=this.doc.body,u;if(t){i=t.getNodes([3]);r=i[0]||t.startContainer;u=i[i.length-1]||t.endContainer;i=r===t.startContainer?t.startOffset:0;f=u===t.endContainer?t.endOffset:u.length;try{n(t.startContainer,t.endContainer)}catch(e){setTimeout(function(){throw e;},0)}n=rangy.createRange(this.doc);try{n.setStart(r,i)}catch(o){}try{n.setEnd(u,f)}catch(s){}try{this.setSelection(n)}catch(h){}}else n(r,r)},insertHTML:function(n){var n=rangy.createRange(this.doc).createContextualFragment(n),t=n.lastChild;this.insertNode(n);t&&this.setAfter(t)},insertNode:function(n){var t=this.getRange();t&&t.insertNode(n)},surround:function(n){var t=this.getRange();if(t)try{t.surroundContents(n);this.selectNode(n)}catch(i){n.appendChild(t.extractContents());t.insertNode(n)}},scrollIntoView:function(){var r=this.doc,t=r.documentElement.scrollHeight>r.documentElement.offsetHeight,i,u;if((i=r._wysihtml5ScrollIntoViewElement)||(i=r.createElement("span"),i.innerHTML=n.INVISIBLE_SPACE),i=r._wysihtml5ScrollIntoViewElement=i,t){if(this.insertNode(i),t=i,u=0,t.parentNode)do u+=t.offsetTop||0,t=t.offsetParent;while(t);t=u;i.parentNode.removeChild(i);t>r.body.scrollTop&&(r.body.scrollTop=t)}},selectLine:function(){n.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var n=this.doc.defaultView.getSelection();n.modify("extend","left","lineboundary");n.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var t=this.doc.selection.createRange(),i=t.boundingTop,r=this.doc.body.scrollWidth,n;if(t.moveToPoint){for(0===i&&(n=this.doc.createElement("span"),this.insertNode(n),i=n.offsetTop,n.parentNode.removeChild(n)),i+=1,n=-10;n<r;n+=2)try{t.moveToPoint(n,i);break}catch(u){}for(n=this.doc.selection.createRange();0<=r;r--)try{n.moveToPoint(r,i);break}catch(f){}t.setEndPoint("EndToEnd",n);t.select()}},getText:function(){var n=this.getSelection();return n?n.toString():""},getNodes:function(n,t){var i=this.getRange();return i?i.getNodes([n],t):[]},getRange:function(){var n=this.getSelection();return n&&n.rangeCount&&n.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(n){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow).setSingleRange(n)}})}(wysihtml5),function(n,t){function u(n,i){return t.dom.isCharacterDataNode(n)?0==i?!!n.previousSibling:i==n.length?!!n.nextSibling:!0:0<i&&i<n.childNodes.length}function i(n,r,u){var f,e;if(t.dom.isCharacterDataNode(r)&&(0==u?(u=t.dom.getNodeIndex(r),r=r.parentNode):u==r.length?(u=t.dom.getNodeIndex(r)+1,r=r.parentNode):f=t.dom.splitDataNode(r,u)),!f){for(f=r.cloneNode(!1),f.id&&f.removeAttribute("id");e=r.childNodes[u];)f.appendChild(e);t.dom.insertAfter(f,r)}return r==n?f:i(n,f.parentNode,t.dom.getNodeIndex(f))}function r(t){this.firstTextNode=(this.isElementMerge=t.nodeType==n.ELEMENT_NODE)?t.lastChild:t;this.textNodes=[this.firstTextNode]}function f(n,t,i,r){this.tagNames=n||[o];this.cssClass=t||"";this.similarClassRegExp=i;this.normalize=r;this.applyToAnyTagName=!1}var o="span",e=/\s+/g;r.prototype={doMerge:function(){for(var r=[],i,n,t=0,u=this.textNodes.length;t<u;++t)i=this.textNodes[t],n=i.parentNode,r[t]=i.data,t&&(n.removeChild(i),n.hasChildNodes()||n.parentNode.removeChild(n));return this.firstTextNode.data=r=r.join("")},getLength:function(){for(var n=this.textNodes.length,t=0;n--;)t+=this.textNodes[n].length;return t},toString:function(){for(var t=[],n=0,i=this.textNodes.length;n<i;++n)t[n]="'"+this.textNodes[n].data+"'";return"[Merge("+t.join(",")+")]"}};f.prototype={getAncestorWithClass:function(i){for(var r,u;i;){if(this.cssClass?(r=this.cssClass,i.className)?(u=i.className.match(this.similarClassRegExp)||[],r=u[u.length-1]===r):r=!1:r=!0,i.nodeType==n.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&r)return i;i=i.parentNode}return!1},postApply:function(n,t){for(var s=n[0],f=n[n.length-1],e=[],i,h=s,l=f,a=0,v=f.length,o,y,u=0,c=n.length;u<c;++u)(o=n[u],y=this.getAdjacentMergeableTextNode(o.parentNode,!1))?(i||(i=new r(y),e.push(i)),i.textNodes.push(o),o===s&&(h=i.firstTextNode,a=h.length),o===f)&&(l=i.firstTextNode,v=i.getLength()):i=null;if((s=this.getAdjacentMergeableTextNode(f.parentNode,!0))&&(i||(i=new r(f),e.push(i)),i.textNodes.push(s)),e.length){for(u=0,c=e.length;u<c;++u)e[u].doMerge();t.setStart(h,a);t.setEnd(l,v)}},getAdjacentMergeableTextNode:function(t,i){var r=t.nodeType==n.TEXT_NODE,f=r?t.parentNode:t,u=i?"nextSibling":"previousSibling";if(r){if((r=t[u])&&r.nodeType==n.TEXT_NODE)return r}else if((r=f[u])&&this.areElementsMergeable(t,r))return r[i?"firstChild":"lastChild"];return null},areElementsMergeable:function(n,i){var r,o,f,u;if((r=t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase()))&&(r=t.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase()))&&(r=n.className.replace(e," ")==i.className.replace(e," ")))n:if(n.attributes.length!=i.attributes.length)r=!1;else{for(r=0,o=n.attributes.length;r<o;++r)if(f=n.attributes[r],u=f.name,"class"!=u&&(u=i.attributes.getNamedItem(u),f.specified!=u.specified||f.specified&&f.nodeValue!==u.nodeValue)){r=!1;break n}r=!0}return r},createContainer:function(n){return n=n.createElement(this.tagNames[0]),this.cssClass&&(n.className=this.cssClass),n},applyToTextNode:function(n){var i=n.parentNode;1==i.childNodes.length&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())?this.cssClass&&(n=this.cssClass,i.className?(i.className&&(i.className=i.className.replace(this.similarClassRegExp,"")),i.className+=" "+n):i.className=n):(i=this.createContainer(t.dom.getDocument(n)),n.parentNode.insertBefore(i,n),i.appendChild(n))},isRemovable:function(i){return t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&n.lang.string(i.className).trim()==this.cssClass},undoToTextNode:function(n,t,r){if(t.containsNode(r)||(n=t.cloneRange(),n.selectNode(r),n.isPointInRange(t.endContainer,t.endOffset)&&u(t.endContainer,t.endOffset)&&(i(r,t.endContainer,t.endOffset),t.setEndAfter(r)),n.isPointInRange(t.startContainer,t.startOffset)&&u(t.startContainer,t.startOffset)&&(r=i(r,t.startContainer,t.startOffset))),this.similarClassRegExp&&r.className&&(r.className=r.className.replace(this.similarClassRegExp,"")),this.isRemovable(r)){for(t=r,r=t.parentNode;t.firstChild;)r.insertBefore(t.firstChild,t);r.removeChild(t)}},applyToRange:function(t){var i=t.getNodes([n.TEXT_NODE]),r,u,f;if(!i.length)try{r=this.createContainer(t.endContainer.ownerDocument);t.surroundContents(r);this.selectNode(t,r);return}catch(e){}if(t.splitBoundaries(),i=t.getNodes([n.TEXT_NODE]),i.length){for(u=0,f=i.length;u<f;++u)r=i[u],this.getAncestorWithClass(r)||this.applyToTextNode(r);t.setStart(i[0],0);r=i[i.length-1];t.setEnd(r,r.length);this.normalize&&this.postApply(i,t)}},undoToRange:function(t){var i=t.getNodes([n.TEXT_NODE]),r,e,u,f;for(i.length?(t.splitBoundaries(),i=t.getNodes([n.TEXT_NODE])):(i=t.endContainer.ownerDocument.createTextNode(n.INVISIBLE_SPACE),t.insertNode(i),t.selectNode(i),i=[i]),u=0,f=i.length;u<f;++u)r=i[u],(e=this.getAncestorWithClass(r))&&this.undoToTextNode(r,t,e);1==f?this.selectNode(t,i[0]):(t.setStart(i[0],0),r=i[i.length-1],t.setEnd(r,r.length),this.normalize&&this.postApply(i,t))},selectNode:function(t,i){var u=i.nodeType===n.ELEMENT_NODE,f="canHaveHTML"in i?i.canHaveHTML:!0,r=u?i.innerHTML:i.data;if((r=""===r||r===n.INVISIBLE_SPACE)&&u&&f)try{i.innerHTML=n.INVISIBLE_SPACE}catch(e){}t.selectNodeContents(i);r&&u?t.collapse(!1):r&&(t.setStartAfter(i),t.setEndAfter(i))},getTextSelectedByRange:function(n,t){var r=t.cloneRange(),i;return r.selectNodeContents(n),i=r.intersection(t),i=i?i.toString():"",r.detach(),i},isAppliedToRange:function(t){var f=[],i,u=t.getNodes([n.TEXT_NODE]),r,e,o;if(!u.length)return(i=this.getAncestorWithClass(t.startContainer))?[i]:!1;for(r=0,e=u.length;r<e;++r){if(o=this.getTextSelectedByRange(u[r],t),i=this.getAncestorWithClass(u[r]),""!=o&&!i)return!1;f.push(i)}return f},toggleRange:function(n){this.isAppliedToRange(n)?this.undoToRange(n):this.applyToRange(n)}};n.selection.HTMLApplier=f}(wysihtml5,rangy);wysihtml5.Commands=Base.extend({constructor:function(n){this.editor=n;this.composer=n.composer;this.doc=this.composer.doc},support:function(n){return wysihtml5.browser.supportsCommand(this.doc,n)},exec:function(n,t){var i=wysihtml5.commands[n],u=wysihtml5.lang.array(arguments).get(),f=i&&i.exec,r=null;if(this.editor.fire("beforecommand:composer"),f)u.unshift(this.composer),r=f.apply(i,u);else try{r=this.doc.execCommand(n,!1,t)}catch(e){}return this.editor.fire("aftercommand:composer"),r},state:function(n){var t=wysihtml5.commands[n],i=wysihtml5.lang.array(arguments).get(),r=t&&t.state;if(r)return i.unshift(this.composer),r.apply(t,i);try{return this.doc.queryCommandState(n)}catch(u){return!1}},value:function(n){var t=wysihtml5.commands[n],i=t&&t.value;if(i)return i.call(t,this.composer,n);try{return this.doc.queryCommandValue(n)}catch(r){return null}}}),function(n){n.commands.bold={exec:function(t,i){return n.commands.formatInline.exec(t,i,"b")},state:function(t,i){return n.commands.formatInline.state(t,i,"b")},value:function(){}}}(wysihtml5),function(n){function u(u,f){var c=u.doc,s="_wysihtml5-temp-"+ +new Date,h=0,l,e,o;for(n.commands.formatInline.exec(u,i,r,s,/non-matching-class/g),l=c.querySelectorAll(r+"."+s),s=l.length;h<s;h++)for(o in e=l[h],e.removeAttribute("class"),f)e.setAttribute(o,f[o]);h=e;1===s&&(o=t.getTextContent(e),s=!!e.querySelector("*"),o=""===o||o===n.INVISIBLE_SPACE,!s&&o&&(t.setTextContent(e,f.text||e.href),c=c.createTextNode(" "),u.selection.setAfter(e),u.selection.insertNode(c),h=c));u.selection.setAfter(h)}var i,r="A",t=n.dom;n.commands.createLink={exec:function(n,i,r){var f=this.state(n,i);f?n.selection.executeAndRestore(function(){for(var e=f.length,i=0,n,r,u;i<e;i++)n=f[i],r=t.getParentElement(n,{nodeName:"code"}),u=t.getTextContent(n),u.match(t.autoLink.URL_REG_EXP)&&!r?t.renameElement(n,"code"):t.replaceWithChildNodes(n)}):(r="object"==typeof r?r:{href:r},u(n,r))},state:function(t,i){return n.commands.formatInline.state(t,i,"A")},value:function(){return i}}}(wysihtml5),function(n){var t=/wysiwyg-font-size-[a-z\-]+/g;n.commands.fontSize={exec:function(i,r,u){return n.commands.formatInline.exec(i,r,"span","wysiwyg-font-size-"+u,t)},state:function(i,r,u){return n.commands.formatInline.state(i,r,"span","wysiwyg-font-size-"+u,t)},value:function(){}}}(wysihtml5),function(n){var t=/wysiwyg-color-[a-z]+/g;n.commands.foreColor={exec:function(i,r,u){return n.commands.formatInline.exec(i,r,"span","wysiwyg-color-"+u,t)},state:function(i,r,u){return n.commands.formatInline.state(i,r,"span","wysiwyg-color-"+u,t)},value:function(){}}}(wysihtml5),function(n){function i(t){for(t=t.previousSibling;t&&t.nodeType===n.TEXT_NODE&&!n.lang.string(t.data).trim();)t=t.previousSibling;return t}function r(t){for(t=t.nextSibling;t&&t.nodeType===n.TEXT_NODE&&!n.lang.string(t.data).trim();)t=t.nextSibling;return t}function u(n){return"BR"===n.nodeName||"block"===t.getStyle("display").from(n)?!0:!1}function e(i,r,u,f){if(f)var e=t.observe(i,"DOMNodeInserted",function(i){var i=i.target,r;i.nodeType===n.ELEMENT_NODE&&(r=t.getStyle("display").from(i),"inline"!==r.substr(0,6)&&(i.className+=" "+f))});i.execCommand(r,!1,u);e&&e.stop()}function o(n,t){n.selection.selectLine();n.selection.surround(t);var u=r(t),f=i(t);u&&"BR"===u.nodeName&&u.parentNode.removeChild(u);f&&"BR"===f.nodeName&&f.parentNode.removeChild(f);(u=t.lastChild)&&"BR"===u.nodeName&&u.parentNode.removeChild(u);n.selection.selectNode(t)}var t=n.dom,f="H1 H2 H3 H4 H5 H6 P BLOCKQUOTE DIV".split(" ");n.commands.formatBlock={exec:function(s,h,c,l,a){var y=s.doc,v=this.state(s,h,c,l,a),p,c="string"==typeof c?c.toUpperCase():c;if(v)s.selection.executeAndRestoreSimple(function(){var f;if(a&&(v.className=v.className.replace(a,"")),f=!!n.lang.string(v.className).trim(),f||v.nodeName!==(c||"DIV"))f&&t.renameElement(v,"DIV");else{var f=v,o=f.ownerDocument,e=r(f),s=i(f);e&&!u(e)&&f.parentNode.insertBefore(o.createElement("br"),e);s&&!u(s)&&f.parentNode.insertBefore(o.createElement("br"),f);t.replaceWithChildNodes(v)}});else{if((null===c||n.lang.array(f).contains(c))&&(p=s.selection.getSelectedNode(),v=t.getParentElement(p,{nodeName:f}))){s.selection.executeAndRestoreSimple(function(){if(c&&(v=t.renameElement(v,c)),l){var n=v;n.className?(n.className=n.className.replace(a,""),n.className+=" "+l):n.className=l}});return}s.commands.support(h)?e(y,h,c||"DIV",l):(v=y.createElement(c||"DIV"),l&&(v.className=l),o(s,v))}},state:function(n,i,r,u,f){return r="string"==typeof r?r.toUpperCase():r,n=n.selection.getSelectedNode(),t.getParentElement(n,{nodeName:r,className:u,classRegExp:f})},value:function(){}}}(wysihtml5),function(n){function i(i,u,f){var e=i+":"+u;if(!t[e]){var s=t,h=n.selection.HTMLApplier,o=r[i],i=o?[i.toLowerCase(),o.toLowerCase()]:[i.toLowerCase()];s[e]=new h(i,u,f,!0)}return t[e]}var r={strong:"b",em:"i",b:"strong",i:"em"},t={};n.commands.formatInline={exec:function(n,t,r,u,f){if(t=n.selection.getRange(),!t)return!1;i(r,u,f).toggleRange(t);n.selection.setSelection(t)},state:function(t,u,f,e,o){var u=t.doc,s=r[f]||f;return!n.dom.hasElementWithTagName(u,f)&&!n.dom.hasElementWithTagName(u,s)||e&&!n.dom.hasElementWithClassName(u,e)?!1:(t=t.selection.getRange(),t?i(f,e,o).isAppliedToRange(t):!1)},value:function(){}}}(wysihtml5),function(n){n.commands.insertHTML={exec:function(n,t,i){n.commands.support(t)?n.doc.execCommand(t,!1,i):n.selection.insertHTML(i)},state:function(){return!1},value:function(){}}}(wysihtml5),function(n){n.commands.insertImage={exec:function(t,i,r){var r="object"==typeof r?r:{src:r},f=t.doc,i=this.state(t),u;if(i)t.selection.setBefore(i),r=i.parentNode,r.removeChild(i),n.dom.removeEmptyTextNodes(r),"A"===r.nodeName&&!r.firstChild&&(t.selection.setAfter(r),r.parentNode.removeChild(r)),n.quirks.redraw(t.element);else{i=f.createElement("IMG");for(u in r)i[u]=r[u];t.selection.insertNode(i);n.browser.hasProblemsSettingCaretAfterImg()?(r=f.createTextNode(n.INVISIBLE_SPACE),t.selection.insertNode(r),t.selection.setAfter(r)):t.selection.setAfter(i)}},state:function(t){var i;return n.dom.hasElementWithTagName(t.doc,"IMG")?(i=t.selection.getSelectedNode(),!i)?!1:"IMG"===i.nodeName?i:i.nodeType!==n.ELEMENT_NODE?!1:(i=t.selection.getText(),i=n.lang.string(i).trim())?!1:(t=t.selection.getNodes(n.ELEMENT_NODE,function(n){return"IMG"===n.nodeName}),1!==t.length?!1:t[0]):!1},value:function(n){return(n=this.state(n))&&n.src}}}(wysihtml5),function(n){var t="<br>"+(n.browser.needsSpaceAfterLineBreak()?" ":"");n.commands.insertLineBreak={exec:function(i,r){i.commands.support(r)?(i.doc.execCommand(r,!1,null),n.browser.autoScrollsToCaret()||i.selection.scrollIntoView()):i.commands.exec("insertHTML",t)},state:function(){return!1},value:function(){}}}(wysihtml5),function(n){n.commands.insertOrderedList={exec:function(t,i){var r=t.doc,u=t.selection.getSelectedNode(),f=n.dom.getParentElement(u,{nodeName:"OL"}),o=n.dom.getParentElement(u,{nodeName:"UL"}),u="_wysihtml5-temp-"+(new Date).getTime(),e;t.commands.support(i)?r.execCommand(i,!1,null):f?t.selection.executeAndRestoreSimple(function(){n.dom.resolveList(f)}):o?t.selection.executeAndRestoreSimple(function(){n.dom.renameElement(o,"ol")}):(t.commands.exec("formatBlock","div",u),e=r.querySelector("."+u),r=""===e.innerHTML||e.innerHTML===n.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){f=n.dom.convertToList(e,"ol")}),r&&t.selection.selectNode(f.querySelector("li")))},state:function(t){return t=t.selection.getSelectedNode(),n.dom.getParentElement(t,{nodeName:"OL"})},value:function(){}}}(wysihtml5),function(n){n.commands.insertUnorderedList={exec:function(t,i){var r=t.doc,u=t.selection.getSelectedNode(),f=n.dom.getParentElement(u,{nodeName:"UL"}),o=n.dom.getParentElement(u,{nodeName:"OL"}),u="_wysihtml5-temp-"+(new Date).getTime(),e;t.commands.support(i)?r.execCommand(i,!1,null):f?t.selection.executeAndRestoreSimple(function(){n.dom.resolveList(f)}):o?t.selection.executeAndRestoreSimple(function(){n.dom.renameElement(o,"ul")}):(t.commands.exec("formatBlock","div",u),e=r.querySelector("."+u),r=""===e.innerHTML||e.innerHTML===n.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){f=n.dom.convertToList(e,"ul")}),r&&t.selection.selectNode(f.querySelector("li")))},state:function(t){return t=t.selection.getSelectedNode(),n.dom.getParentElement(t,{nodeName:"UL"})},value:function(){}}}(wysihtml5),function(n){n.commands.italic={exec:function(t,i){return n.commands.formatInline.exec(t,i,"i")},state:function(t,i){return n.commands.formatInline.state(t,i,"i")},value:function(){}}}(wysihtml5),function(n){var t=/wysiwyg-text-align-[a-z]+/g;n.commands.justifyCenter={exec:function(i){return n.commands.formatBlock.exec(i,"formatBlock",null,"wysiwyg-text-align-center",t)},state:function(i){return n.commands.formatBlock.state(i,"formatBlock",null,"wysiwyg-text-align-center",t)},value:function(){}}}(wysihtml5),function(n){var t=/wysiwyg-text-align-[a-z]+/g;n.commands.justifyLeft={exec:function(i){return n.commands.formatBlock.exec(i,"formatBlock",null,"wysiwyg-text-align-left",t)},state:function(i){return n.commands.formatBlock.state(i,"formatBlock",null,"wysiwyg-text-align-left",t)},value:function(){}}}(wysihtml5),function(n){var t=/wysiwyg-text-align-[a-z]+/g;n.commands.justifyRight={exec:function(i){return n.commands.formatBlock.exec(i,"formatBlock",null,"wysiwyg-text-align-right",t)},state:function(i){return n.commands.formatBlock.state(i,"formatBlock",null,"wysiwyg-text-align-right",t)},value:function(){}}}(wysihtml5),function(n){n.commands.underline={exec:function(t,i){return n.commands.formatInline.exec(t,i,"u")},state:function(t,i){return n.commands.formatInline.state(t,i,"u")},value:function(){}}}(wysihtml5),function(n){var i='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"<\/span>",r='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+n.INVISIBLE_SPACE+"<\/span>",t=n.dom;n.UndoManager=n.lang.Dispatcher.extend({constructor:function(n){this.editor=n;this.composer=n.composer;this.element=this.composer.element;this.history=[this.composer.getValue()];this.position=1;this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var u=this,f=this.composer.sandbox.getDocument(),o,s,h,e;t.observe(this.element,"keydown",function(n){if(!(n.altKey||!n.ctrlKey&&!n.metaKey)){var t=n.keyCode,i=90===t&&n.shiftKey||89===t;90===t&&!n.shiftKey?(u.undo(),n.preventDefault()):i&&(u.redo(),n.preventDefault())}});t.observe(this.element,"keydown",function(n){n=n.keyCode;n!==o&&(o=n,(8===n||46===n)&&u.transact())});n.browser.hasUndoInContextMenu()&&(e=function(){for(var n;n=f.querySelector("._wysihtml5-temp");)n.parentNode.removeChild(n);clearInterval(s)},t.observe(this.element,"contextmenu",function(){e();u.composer.selection.executeAndRestoreSimple(function(){u.element.lastChild&&u.composer.selection.setAfter(u.element.lastChild);f.execCommand("insertHTML",!1,i);f.execCommand("insertHTML",!1,r);f.execCommand("undo",!1,null)});s=setInterval(function(){f.getElementById("_wysihtml5-redo")?(e(),u.redo()):f.getElementById("_wysihtml5-undo")||(e(),u.undo())},400);h||(h=!0,t.observe(document,"mousedown",e),t.observe(f,["mousedown","paste","cut","copy"],e))}));this.editor.observe("newword:composer",function(){u.transact()}).observe("beforecommand:composer",function(){u.transact()})},transact:function(){var t=this.history[this.position-1],n=this.composer.getValue();n!=t&&(40<(this.history.length=this.position)&&(this.history.shift(),this.position--),this.position++,this.history.push(n))},undo:function(){this.transact();1>=this.position||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(n){this.composer.setValue(n);this.editor.focus(!0)}})}(wysihtml5);wysihtml5.views.View=Base.extend({constructor:function(n,t,i){this.parent=n;this.element=t;this.config=i;this._observeViewChange()},_observeViewChange:function(){var n=this;this.parent.observe("beforeload",function(){n.parent.observe("change_view",function(t){t===n.name?(n.parent.currentView=n,n.show(),setTimeout(function(){n.focus()},0)):n.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(n){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(n){var t=n.dom,i=n.browser;n.views.Composer=n.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(n,t,i){this.base(n,t,i);this.textarea=this.parent.textarea;this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var i=this.isEmpty()?"":n.quirks.getCorrectInnerHTML(this.element);return t&&(i=this.parent.parse(i)),n.lang.string(i).replace(n.INVISIBLE_SPACE).by("")},setValue:function(n,t){t&&(n=this.parent.parse(n));this.element.innerHTML=n},show:function(){this.iframe.style.display=this._displayStyle||"";this.disable();this.enable()},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe);"none"===this._displayStyle&&(this._displayStyle=null);this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable");this.base()},enable:function(){this.element.setAttribute("contentEditable","true");this.base()},focus:function(t){n.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear();this.base();var i=this.element.lastChild;t&&i&&("BR"===i.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var n=this.element.innerHTML;return""===n||n===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector("blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea")},_initSandbox:function(){var r=this,n,i;this.sandbox=new t.Sandbox(function(){r._create()},{stylesheets:this.config.stylesheets});this.iframe=this.sandbox.getIframe();n=document.createElement("input");n.type="hidden";n.name="_wysihtml5_mode";n.value=1;i=this.textarea.element;t.insert(this.iframe).after(i);t.insert(n).after(i)},_create:function(){var u=this,r;this.doc=this.sandbox.getDocument();this.element=this.doc.body;this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(!0);this.enable();this.selection=new n.Selection(this.parent);this.commands=new n.Commands(this.parent);t.copyAttributes("className spellcheck title lang dir accessKey".split(" ")).from(this.textarea.element).to(this.element);t.addClass(this.element,this.config.composerClassName);this.config.style&&this.style();this.observe();r=this.config.name;r&&(t.addClass(this.element,r),t.addClass(this.iframe,r));(r="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder"))&&t.simulatePlaceholder(this.parent,this,r);this.commands.exec("styleWithCSS",!1);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){u.focus()},100);n.quirks.insertLineBreakOnReturn(this);i.clearsContentEditableCorrectly()||n.quirks.ensureProperClearing(this);i.clearsListsInContentEditableCorrectly()||n.quirks.ensureProperClearingOfLists(this);this.initSync&&this.config.sync&&this.initSync();this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r=this,u=i.canDisableAutoLinking(),f=i.doesAutoLinkingInContentEditable();if(u&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!f||f&&u)&&this.parent.observe("newword:composer",function(){r.selection.executeAndRestore(function(n,i){t.autoLink(i.parentNode)})});var o=this.sandbox.getDocument().getElementsByTagName("a"),s=t.autoLink.URL_REG_EXP,e=function(i){return i=n.lang.string(t.getTextContent(i)).trim(),"www."===i.substr(0,4)&&(i="http://"+i),i};t.observe(this.element,"keydown",function(n){if(o.length){var n=r.selection.getSelectedNode(n.target.ownerDocument),i=t.getParentElement(n,{nodeName:"A"},4),u;i&&(u=e(i),setTimeout(function(){var n=e(i);n!==u&&n.match(s)&&i.setAttribute("href",n)},0))}})}},_initObjectResizing:function(){var u=["width","height"],f=u.length,r=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing);this.config.allowObjectResizing?i.supportsEvent("resizeend")&&t.observe(r,"resizeend",function(t){for(var t=t.target||t.srcElement,e=t.style,o=0,i;o<f;o++)i=u[o],e[i]&&(t.setAttribute(i,parseInt(e[i],10)),e[i]="");n.quirks.redraw(r)}):i.supportsEvent("resizestart")&&t.observe(r,"resizestart",function(n){n.preventDefault()})},_initUndoManager:function(){new n.UndoManager(this.parent)}})}(wysihtml5),function(n){var t=n.dom,i=document,u=window,e=i.createElement("div"),r="background-color color cursor font-family font-size font-style font-variant font-weight line-height letter-spacing text-align text-decoration text-indent text-rendering word-break word-wrap word-spacing".split(" "),f="background-color border-collapse border-bottom-color border-bottom-style border-bottom-width border-left-color border-left-style border-left-width border-right-color border-right-style border-right-width border-top-color border-top-style border-top-width clear display float margin-bottom margin-left margin-right margin-top outline-color outline-offset outline-width outline-style padding-left padding-right padding-top padding-bottom position top left right bottom z-index vertical-align text-align -webkit-box-sizing -moz-box-sizing -ms-box-sizing box-sizing -webkit-box-shadow -moz-box-shadow -ms-box-shadow box-shadow -webkit-border-top-right-radius -moz-border-radius-topright border-top-right-radius -webkit-border-bottom-right-radius -moz-border-radius-bottomright border-bottom-right-radius -webkit-border-bottom-left-radius -moz-border-radius-bottomleft border-bottom-left-radius -webkit-border-top-left-radius -moz-border-radius-topleft border-top-left-radius width height".split(" "),o="width height top left right bottom".split(" "),s=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",n.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],h=function(n){if(n.setActive)try{n.setActive()}catch(o){}else{var r=n.style,f=i.documentElement.scrollTop||i.body.scrollTop,e=i.documentElement.scrollLeft||i.body.scrollLeft,r={position:r.position,top:r.top,left:r.left,WebkitUserSelect:r.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(n);n.focus();t.setStyles(r).on(n);u.scrollTo&&u.scrollTo(e,f)}};n.views.Composer.prototype.style=function(){var l=this,a=i.querySelector(":focus"),c=this.textarea.element,v=c.hasAttribute("placeholder"),w=v&&c.getAttribute("placeholder"),y,p;return this.focusStylesHost=this.focusStylesHost||e.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||e.cloneNode(!1),v&&c.removeAttribute("placeholder"),c===a&&c.blur(),t.copyStyles(f).from(c).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(r).from(c).to(this.element).andTo(this.blurStylesHost),t.insertCSS(s).into(this.element.ownerDocument),h(c),t.copyStyles(f).from(c).to(this.focusStylesHost),t.copyStyles(r).from(c).to(this.focusStylesHost),y=n.lang.array(f).without(["display"]),a?a.focus():c.blur(),v&&c.setAttribute("placeholder",w),n.browser.hasCurrentStyleProperty()||(p=t.observe(u,"resize",function(){if(t.contains(document.documentElement,l.iframe)){var n=t.getStyle("display").from(c),i=t.getStyle("display").from(l.iframe);c.style.display="";l.iframe.style.display="none";t.copyStyles(o).from(c).to(l.iframe).andTo(l.focusStylesHost).andTo(l.blurStylesHost);l.iframe.style.display=i;c.style.display=n}else p.stop()})),this.parent.observe("focus:composer",function(){t.copyStyles(y).from(l.focusStylesHost).to(l.iframe);t.copyStyles(r).from(l.focusStylesHost).to(l.element)}),this.parent.observe("blur:composer",function(){t.copyStyles(y).from(l.blurStylesHost).to(l.iframe);t.copyStyles(r).from(l.blurStylesHost).to(l.element)}),this}}(wysihtml5),function(n){var t=n.dom,i=n.browser,r={66:"bold",73:"italic",85:"underline"};n.views.Composer.prototype.observe=function(){var u=this,o=this.getValue(),s=this.sandbox.getIframe(),f=this.element,h=i.supportsEventsInIframeCorrectly()?f:this.sandbox.getWindow(),l=i.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"],e,c;t.observe(s,"DOMNodeRemoved",function(){clearInterval(e);u.parent.fire("destroy:composer")});e=setInterval(function(){t.contains(document.documentElement,s)||(clearInterval(e),u.parent.fire("destroy:composer"))},250);t.observe(h,"focus",function(){u.parent.fire("focus").fire("focus:composer");setTimeout(function(){o=u.getValue()},0)});t.observe(h,"blur",function(){o!==u.getValue()&&u.parent.fire("change").fire("change:composer");u.parent.fire("blur").fire("blur:composer")});n.browser.isIos()&&t.observe(f,"blur",function(){var n=f.ownerDocument.createElement("input"),t=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft;try{u.selection.insertNode(n)}catch(r){f.appendChild(n)}n.focus();n.parentNode.removeChild(n);window.scrollTo(i,t)});t.observe(f,"dragenter",function(){u.parent.fire("unset_placeholder")});i.firesOnDropOnlyWhenOnDragOverIsCancelled()&&t.observe(f,["dragover","dragenter"],function(n){n.preventDefault()});t.observe(f,l,function(n){var t=n.dataTransfer,r;t&&i.supportsDataTransfer()&&(r=t.getData("text/html")||t.getData("text/plain"));r?(f.focus(),u.commands.exec("insertHTML",r),u.parent.fire("paste").fire("paste:composer"),n.stopPropagation(),n.preventDefault()):setTimeout(function(){u.parent.fire("paste").fire("paste:composer")},0)});t.observe(f,"keyup",function(t){t=t.keyCode;(t===n.SPACE_KEY||t===n.ENTER_KEY)&&u.parent.fire("newword:composer")});this.parent.observe("paste:composer",function(){setTimeout(function(){u.parent.fire("newword:composer")},0)});i.canSelectImagesInContentEditable()||t.observe(f,"mousedown",function(n){var t=n.target;"IMG"===t.nodeName&&(u.selection.selectNode(t),n.preventDefault())});t.observe(f,"keydown",function(n){var t=r[n.keyCode];(n.ctrlKey||n.metaKey)&&!n.altKey&&t&&(u.commands.exec(t),n.preventDefault())});t.observe(f,"keydown",function(t){var r=u.selection.getSelectedNode(!0),i=t.keyCode;r&&"IMG"===r.nodeName&&(i===n.BACKSPACE_KEY||i===n.DELETE_KEY)&&(i=r.parentNode,i.removeChild(r),"A"===i.nodeName&&!i.firstChild&&i.parentNode.removeChild(i),setTimeout(function(){n.quirks.redraw(f)},0),t.preventDefault())});c={IMG:"Image: ",A:"Link: "};t.observe(f,"mouseover",function(n){var n=n.target,t=n.nodeName;"A"!==t&&"IMG"!==t||n.hasAttribute("title")||(t=c[t]+(n.getAttribute("href")||n.getAttribute("src")),n.setAttribute("title",t))})}}(wysihtml5),function(n){n.views.Synchronizer=Base.extend({constructor:function(n,t,i){this.editor=n;this.textarea=t;this.composer=i;this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(n.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(n){var t=this.textarea.getValue();t?this.composer.setValue(t,n):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(n){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(n):this.fromComposerToTextarea(n)},_observe:function(){var i,t=this,r=this.textarea.element.form,u=function(){i=setInterval(function(){t.fromComposerToTextarea()},400)},f=function(){clearInterval(i);i=null};u();r&&(n.dom.observe(r,"submit",function(){t.sync(!0)}),n.dom.observe(r,"reset",function(){setTimeout(function(){t.fromTextareaToComposer()},0)}));this.editor.observe("change_view",function(n){n!=="composer"||i?n==="textarea"&&(t.fromComposerToTextarea(!0),f()):(t.fromTextareaToComposer(!0),u())});this.editor.observe("destroy:composer",f)}})}(wysihtml5);wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(n,t,i){this.base(n,t,i);this._observe()},clear:function(){this.element.value=""},getValue:function(n){var t=this.isEmpty()?"":this.element.value;return n&&(t=this.parent.parse(t)),t},setValue:function(n,t){t&&(n=this.parent.parse(n));this.element.value=n},hasPlaceholderSet:function(){var t=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),i=this.element.getAttribute("placeholder")||null,n=this.element.value;return t&&!n||n===i},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var t=this.element,n=this.parent,i={focusin:"focus",focusout:"blur"},r=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];n.observe("beforeload",function(){wysihtml5.dom.observe(t,r,function(t){t=i[t.type]||t.type;n.fire(t).fire(t+":textarea")});wysihtml5.dom.observe(t,["paste","drop"],function(){setTimeout(function(){n.fire("paste").fire("paste:textarea")},0)})})}}),function(n){var t=n.dom;n.toolbar.Dialog=n.lang.Dispatcher.extend({constructor:function(n,t){this.link=n;this.container=t},_observe:function(){var i,r;if(!this._observed){i=this;r=function(n){var t=i._serialize();t==i.elementToChange?i.fire("edit",t):i.fire("save",t);i.hide();n.preventDefault();n.stopPropagation()};t.observe(i.link,"click",function(){t.hasClass(i.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){i.hide()},0)});t.observe(this.container,"keydown",function(t){var u=t.keyCode;u===n.ENTER_KEY&&r(t);u===n.ESCAPE_KEY&&i.hide()});t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",r);t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(n){i.fire("cancel");i.hide();n.preventDefault();n.stopPropagation()});for(var f=this.container.querySelectorAll("input, select, textarea"),u=0,e=f.length,o=function(){clearInterval(i.interval)};u<e;u++)t.observe(f[u],"change",o);this._observed=!0}},_serialize:function(){for(var i=this.elementToChange||{},t=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),r=t.length,n=0;n<r;n++)i[t[n].getAttribute("data-wysihtml5-dialog-field")]=t[n].value;return i},_interpolate:function(n){for(var t,i,f=document.querySelector(":focus"),u=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),e=u.length,r=0;r<e;r++)t=u[r],t===f||n&&"hidden"===t.type||(i=t.getAttribute("data-wysihtml5-dialog-field"),i=this.elementToChange?this.elementToChange[i]||"":t.defaultValue,t.value=i)},show:function(n){var r=this,i=this.container.querySelector("input, select, textarea");if(this.elementToChange=n,this._observe(),this._interpolate(),n&&(this.interval=setInterval(function(){r._interpolate(!0)},500)),t.addClass(this.link,"wysihtml5-command-dialog-opened"),this.container.style.display="",this.fire("show"),i&&!n)try{i.focus()}catch(u){}},hide:function(){clearInterval(this.interval);this.elementToChange=null;t.removeClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="none";this.fire("hide")}})}(wysihtml5),function(n){var t=n.dom,r={position:"relative"},i={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},u={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},f={"x-webkit-speech":"",speech:""};n.toolbar.Speech=function(e,o){var s=document.createElement("input"),h;if(n.browser.supportsSpeechApiOn(s)){h=document.createElement("div");n.lang.object(i).merge({width:o.offsetWidth+"px",height:o.offsetHeight+"px"});t.insert(s).into(h);t.insert(h).into(o);t.setStyles(u).on(s);t.setAttributes(f).on(s);t.setStyles(i).on(h);t.setStyles(r).on(o);t.observe(s,"onwebkitspeechchange"in s?"webkitspeechchange":"speechchange",function(){e.execCommand("insertText",s.value);s.value=""});t.observe(s,"click",function(n){t.hasClass(o,"wysihtml5-command-disabled")&&n.preventDefault();n.stopPropagation()})}else o.style.display="none"}}(wysihtml5),function(n){var t=n.dom;n.toolbar.Toolbar=Base.extend({constructor:function(t,i){this.editor=t;this.container="string"==typeof i?document.getElementById(i):i;this.composer=t.composer;this._getLinks("command");this._getLinks("action");this._observe();this.show();for(var u=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),f=u.length,r=0;r<f;r++)new n.toolbar.Speech(this,u[r])},_getLinks:function(t){for(var e=this[t+"Links"]=n.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),h=e.length,u=0,c=this[t+"Mapping"]={},i,o,r,f,s;u<h;u++)i=e[u],r=i.getAttribute("data-wysihtml5-"+t),f=i.getAttribute("data-wysihtml5-"+t+"-value"),o=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+r+"']"),s=this._getDialog(i,r),c[r+":"+f]={link:i,group:o,name:r,value:f,dialog:s,state:!1}},_getDialog:function(t,i){var r=this,u=this.container.querySelector("[data-wysihtml5-dialog='"+i+"']"),f,e;return u&&(f=new n.toolbar.Dialog(t,u),f.observe("show",function(){e=r.composer.selection.getBookmark();r.editor.fire("show:dialog",{command:i,dialogContainer:u,commandLink:t})}),f.observe("save",function(n){e&&r.composer.selection.setBookmark(e);r._execCommand(i,n);r.editor.fire("save:dialog",{command:i,dialogContainer:u,commandLink:t})}),f.observe("cancel",function(){r.editor.focus(!1);r.editor.fire("cancel:dialog",{command:i,dialogContainer:u,commandLink:t})})),f},execCommand:function(n,t){if(!this.commandsDisabled){var i=this.commandMapping[n+":"+t];i&&i.dialog&&!i.state?i.dialog.show():this._execCommand(n,t)}},_execCommand:function(n,t){this.editor.focus(!1);this.composer.commands.exec(n,t);this._updateLinkStates()},execAction:function(n){var t=this.editor;switch(n){case"change_view":t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")}},_observe:function(){for(var n=this,r=this.editor,i=this.container,f=this.commandLinks.concat(this.actionLinks),e=f.length,u=0;u<e;u++)t.setAttributes({href:"javascript:;",unselectable:"on"}).on(f[u]);t.delegate(i,"[data-wysihtml5-command]","mousedown",function(n){n.preventDefault()});t.delegate(i,"[data-wysihtml5-command]","click",function(t){var i=this.getAttribute("data-wysihtml5-command"),r=this.getAttribute("data-wysihtml5-command-value");n.execCommand(i,r);t.preventDefault()});t.delegate(i,"[data-wysihtml5-action]","click",function(t){var i=this.getAttribute("data-wysihtml5-action");n.execAction(i);t.preventDefault()});r.observe("focus:composer",function(){n.bookmark=null;clearInterval(n.interval);n.interval=setInterval(function(){n._updateLinkStates()},500)});r.observe("blur:composer",function(){clearInterval(n.interval)});r.observe("destroy:composer",function(){clearInterval(n.interval)});r.observe("change_view",function(r){setTimeout(function(){n.commandsDisabled="composer"!==r;n._updateLinkStates();n.commandsDisabled?t.addClass(i,"wysihtml5-commands-disabled"):t.removeClass(i,"wysihtml5-commands-disabled")},0)})},_updateLinkStates:function(){var u=this.commandMapping,e=this.actionMapping,f,r,i;for(f in u)(i=u[f],this.commandsDisabled?(r=!1,t.removeClass(i.link,"wysihtml5-command-active"),i.group&&t.removeClass(i.group,"wysihtml5-command-active"),i.dialog&&i.dialog.hide()):(r=this.composer.commands.state(i.name,i.value),n.lang.object(r).isArray()&&(r=1===r.length?r[0]:!0),t.removeClass(i.link,"wysihtml5-command-disabled"),i.group&&t.removeClass(i.group,"wysihtml5-command-disabled")),i.state!==r)&&((i.state=r)?(t.addClass(i.link,"wysihtml5-command-active"),i.group&&t.addClass(i.group,"wysihtml5-command-active"),i.dialog&&("object"==typeof r?i.dialog.show(r):i.dialog.hide())):(t.removeClass(i.link,"wysihtml5-command-active"),i.group&&t.removeClass(i.group,"wysihtml5-command-active"),i.dialog&&i.dialog.hide()));for(f in e)u=e[f],"change_view"===u.name&&(u.state=this.editor.currentView===this.editor.textarea,u.state?t.addClass(u.link,"wysihtml5-action-active"):t.removeClass(u.link,"wysihtml5-action-active"))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(n){var t={name:void 0,style:!0,toolbar:void 0,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:n.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:void 0,allowObjectResizing:!0,supportTouchDevices:!0};n.Editor=n.lang.Dispatcher.extend({constructor:function(i,r){if(this.textareaElement="string"==typeof i?document.getElementById(i):i,this.config=n.lang.object({}).merge(t).merge(r).get(),this.currentView=this.textarea=new n.views.Textarea(this,this.textareaElement,this.config),this._isCompatible=n.browser.supported(),this._isCompatible&&(this.config.supportTouchDevices||!n.browser.isTouchDevice())){n.dom.addClass(document.body,this.config.bodyClassName);this.currentView=this.composer=new n.views.Composer(this,this.textareaElement,this.config);"function"==typeof this.config.parser&&this._initParser();this.observe("beforeload",function(){this.synchronizer=new n.views.Synchronizer(this,this.textarea,this.composer);this.config.toolbar&&(this.toolbar=new n.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(f){}}else{var u=this;setTimeout(function(){u.fire("beforeload").fire("load")},0)}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(n){return this.currentView.getValue(n)},setValue:function(n,t){return n?(this.currentView.setValue(n,t),this):this.clear()},focus:function(n){return this.currentView.focus(n),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var i=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof t&&n.quirks.redraw(t),i},_initParser:function(){this.observe("paste:composer",function(){var t=this;t.composer.selection.executeAndRestore(function(){n.quirks.cleanPastedHTML(t.composer.element);t.parse(t.composer.element)},!0)});this.observe("paste:textarea",function(){this.textarea.setValue(this.parse(this.textarea.getValue()))})}})}(wysihtml5);
/*
//# sourceMappingURL=wysihtml5.bundle.min.js.map
*/